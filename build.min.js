!function(a){function b(a,c){jQuery.each(a,function(d,e){jQuery.isArray(e)||"object"==typeof e?b(e,c):c(e,d,a)})}var c={};!function(){c={version:"5.0.0",stages:[],idCounter:0,ids:{},names:{},shapes:{},listenClickTap:!1,inDblClickWindow:!1,enableTrace:!1,traceArrMax:100,dblClickWindow:400,pixelRatio:void 0,UA:function(){var a=navigator.userAgent.toLowerCase(),b=/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||a.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}}(),Filters:{},Node:function(a){this._init(a)},Shape:function(a){this.__init(a)},Container:function(a){this.__init(a)},Stage:function(a){this.___init(a)},Layer:function(a){this.___init(a)},Group:function(a){this.___init(a)},isDragging:function(){var a=c.DD;return a?a.isDragging:!1},isDragReady:function(){var a=c.DD;return a?!!a.node:!1},_addId:function(a,b){void 0!==b&&(this.ids[b]=a)},_removeId:function(a){void 0!==a&&delete this.ids[a]},_addName:function(a,b){void 0!==b&&(void 0===this.names[b]&&(this.names[b]=[]),this.names[b].push(a))},_removeName:function(a,b){if(void 0!==a){var c=this.names[a];if(void 0!==c){for(var d=0;d<c.length;d++){var e=c[d];e._id===b&&c.splice(d,1)}0===c.length&&delete this.names[a]}}}}}(),function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define(b):a.returnExports=b()}(this,function(){return c}),function(){c.Collection=function(){var a=[].slice.call(arguments),b=a.length,c=0;for(this.length=b;b>c;c++)this[c]=a[c];return this},c.Collection.prototype=[],c.Collection.prototype.each=function(a){for(var b=0;b<this.length;b++)a(this[b],b)},c.Collection.prototype.toArray=function(){var a,b=[],c=this.length;for(a=0;c>a;a++)b.push(this[a]);return b},c.Collection.toCollection=function(a){var b,d=new c.Collection,e=a.length;for(b=0;e>b;b++)d.push(a[b]);return d},c.Collection.mapMethods=function(a){var b,d=a.length;for(b=0;d>b;b++)!function(b){var d=a[b];c.Collection.prototype[d]=function(){var a,b=this.length;for(args=[].slice.call(arguments),a=0;b>a;a++)this[a][d].apply(this[a],args)}}(b)},c.Transform=function(){this.m=[1,0,0,1,0,0]},c.Transform.prototype={translate:function(a,b){this.m[4]+=this.m[0]*a+this.m[2]*b,this.m[5]+=this.m[1]*a+this.m[3]*b},scale:function(a,b){this.m[0]*=a,this.m[1]*=a,this.m[2]*=b,this.m[3]*=b},rotate:function(a){var b=Math.cos(a),c=Math.sin(a),d=this.m[0]*b+this.m[2]*c,e=this.m[1]*b+this.m[3]*c,f=this.m[0]*-c+this.m[2]*b,g=this.m[1]*-c+this.m[3]*b;this.m[0]=d,this.m[1]=e,this.m[2]=f,this.m[3]=g},getTranslation:function(){return{x:this.m[4],y:this.m[5]}},skew:function(a,b){var c=this.m[0]+this.m[2]*b,d=this.m[1]+this.m[3]*b,e=this.m[2]+this.m[0]*a,f=this.m[3]+this.m[1]*a;this.m[0]=c,this.m[1]=d,this.m[2]=e,this.m[3]=f},multiply:function(a){var b=this.m[0]*a.m[0]+this.m[2]*a.m[1],c=this.m[1]*a.m[0]+this.m[3]*a.m[1],d=this.m[0]*a.m[2]+this.m[2]*a.m[3],e=this.m[1]*a.m[2]+this.m[3]*a.m[3],f=this.m[0]*a.m[4]+this.m[2]*a.m[5]+this.m[4],g=this.m[1]*a.m[4]+this.m[3]*a.m[5]+this.m[5];this.m[0]=b,this.m[1]=c,this.m[2]=d,this.m[3]=e,this.m[4]=f,this.m[5]=g},invert:function(){var a=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),b=this.m[3]*a,c=-this.m[1]*a,d=-this.m[2]*a,e=this.m[0]*a,f=a*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),g=a*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=b,this.m[1]=c,this.m[2]=d,this.m[3]=e,this.m[4]=f,this.m[5]=g},getMatrix:function(){return this.m},setAbsolutePosition:function(a,b){var c=this.m[0],d=this.m[1],e=this.m[2],f=this.m[3],g=this.m[4],h=this.m[5],i=(c*(b-h)-d*(a-g))/(c*f-d*e),j=(a-g-e*i)/c;this.translate(j,i)}};var b="canvas",d="2d",e="[object Array]",f="[object Number]",g="[object String]",h=Math.PI/180,i=180/Math.PI,j="#",k="",l="0",m="Kinetic warning: ",n="Kinetic error: ",o="rgb(",p={aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],fuchsia:[255,0,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]},q=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;c.Util={_isElement:function(a){return!(!a||1!=a.nodeType)},_isFunction:function(a){return!!(a&&a.constructor&&a.call&&a.apply)},_isObject:function(a){return!!a&&a.constructor==Object},_isArray:function(a){return Object.prototype.toString.call(a)==e},_isNumber:function(a){return Object.prototype.toString.call(a)==f},_isString:function(a){return Object.prototype.toString.call(a)==g},_hasMethods:function(a){var b,c=[];for(b in a)this._isFunction(a[b])&&c.push(b);return c.length>0},_isInDocument:function(a){for(;a=a.parentNode;)if(a==document)return!0;return!1},_simplifyArray:function(a){var b,d,e=[],f=a.length,g=c.Util;for(b=0;f>b;b++)d=a[b],g._isNumber(d)?d=Math.round(1e3*d)/1e3:g._isString(d)||(d=d.toString()),e.push(d);return e},_getImage:function(a,c){var e,f;a?this._isElement(a)?c(a):this._isString(a)?(e=new Image,e.onload=function(){c(e)},e.src=a):a.data?(f=document.createElement(b),f.width=a.width,f.height=a.height,_context=f.getContext(d),_context.putImageData(a,0,0),this._getImage(f.toDataURL(),c)):c(null):c(null)},_rgbToHex:function(a,b,c){return((1<<24)+(a<<16)+(b<<8)+c).toString(16).slice(1)},_hexToRgb:function(a){a=a.replace(j,k);var b=parseInt(a,16);return{r:255&b>>16,g:255&b>>8,b:255&b}},getRandomColor:function(){for(var a=(16777215*Math.random()<<0).toString(16);a.length<6;)a=l+a;return j+a},get:function(a,b){return void 0===a?b:a},getRGB:function(a){var b;return a in p?(b=p[a],{r:b[0],g:b[1],b:b[2]}):a[0]===j?this._hexToRgb(a.substring(1)):a.substr(0,4)===o?(b=q.exec(a.replace(/ /g,"")),{r:parseInt(b[1],10),g:parseInt(b[2],10),b:parseInt(b[3],10)}):{r:0,g:0,b:0}},_merge:function(a,b){var c=this._clone(b);for(var d in a)c[d]=this._isObject(a[d])?this._merge(a[d],c[d]):a[d];return c},cloneObject:function(a){var b={};for(var c in a)b[c]=this._isObject(a[c])?this._clone(a[c]):a[c];return b},cloneArray:function(a){return a.slice(0)},_degToRad:function(a){return a*h},_radToDeg:function(a){return a*i},_capitalize:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},error:function(a){throw new Error(n+a)},warn:function(b){a.console&&console.warn&&console.warn(m+b)},extend:function(a,b){for(var c in b.prototype)c in a.prototype||(a.prototype[c]=b.prototype[c])},addMethods:function(a,b){var c;for(c in b)a.prototype[c]=b[c]},_getControlPoints:function(a,b,c,d,e,f,g){var h=Math.sqrt(Math.pow(c-a,2)+Math.pow(d-b,2)),i=Math.sqrt(Math.pow(e-c,2)+Math.pow(f-d,2)),j=g*h/(h+i),k=g*i/(h+i),l=c-j*(e-a),m=d-j*(f-b),n=c+k*(e-a),o=d+k*(f-b);return[l,m,n,o]},_expandPoints:function(a,b){var d,e,f=a.length,g=[];for(d=2;f-2>d;d+=2)e=c.Util._getControlPoints(a[d-2],a[d-1],a[d],a[d+1],a[d+2],a[d+3],b),g.push(e[0]),g.push(e[1]),g.push(a[d]),g.push(a[d+1]),g.push(e[2]),g.push(e[3]);return g},_removeLastLetter:function(a){return a.substring(0,a.length-1)}}}(),function(){var b=document.createElement("canvas"),d=b.getContext("2d"),e=a.devicePixelRatio||1,f=d.webkitBackingStorePixelRatio||d.mozBackingStorePixelRatio||d.msBackingStorePixelRatio||d.oBackingStorePixelRatio||d.backingStorePixelRatio||1,g=e/f;c.Canvas=function(a){this.init(a)},c.Canvas.prototype={init:function(a){a=a||{};var b=a.pixelRatio||c.pixelRatio||g;this.pixelRatio=b,this._canvas=document.createElement("canvas"),this._canvas.style.padding=0,this._canvas.style.margin=0,this._canvas.style.border=0,this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top=0,this._canvas.style.left=0},getContext:function(){return this.context},getPixelRatio:function(){return this.pixelRatio},setPixelRatio:function(a){this.pixelRatio=a,this.setSize(this.getWidth(),this.getHeight())},setWidth:function(a){this.width=this._canvas.width=a*this.pixelRatio,this._canvas.style.width=a+"px"},setHeight:function(a){this.height=this._canvas.height=a*this.pixelRatio,this._canvas.style.height=a+"px"},getWidth:function(){return this.width},getHeight:function(){return this.height},setSize:function(a,b){this.setWidth(a),this.setHeight(b)},toDataURL:function(a,b){try{return this._canvas.toDataURL(a,b)}catch(d){try{return this._canvas.toDataURL()}catch(e){return c.Util.warn("Unable to get data URL. "+e.message),""}}}},c.SceneCanvas=function(a){a=a||{};var b=a.width||0,d=a.height||0;c.Canvas.call(this,a),this.context=new c.SceneContext(this),this.setSize(b,d)},c.SceneCanvas.prototype={setWidth:function(a){var b=this.pixelRatio,d=this.getContext()._context;c.Canvas.prototype.setWidth.call(this,a),d.scale(b,b)},setHeight:function(a){var b=this.pixelRatio,d=this.getContext()._context;c.Canvas.prototype.setHeight.call(this,a),d.scale(b,b)}},c.Util.extend(c.SceneCanvas,c.Canvas),c.HitCanvas=function(a){a=a||{};var b=a.width||0,d=a.height||0;c.Canvas.call(this,a),this.context=new c.HitContext(this),this.setSize(b,d)},c.Util.extend(c.HitCanvas,c.Canvas)}(),function(){var a=",",b="(",d=")",e="([",f="])",g=";",h="()",i="=",j=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"];c.Context=function(a){this.init(a)},c.Context.prototype={init:function(a){this.canvas=a,this._context=a._canvas.getContext("2d"),c.enableTrace&&(this.traceArr=[],this._enableTrace())},fillShape:function(a){a.getFillEnabled()&&this._fill(a)},strokeShape:function(a){a.getStrokeEnabled()&&this._stroke(a)},fillStrokeShape:function(a){var b=a.getFillEnabled();b&&this._fill(a),a.getStrokeEnabled()&&this._stroke(a)},getTrace:function(j){var k,l,m,n,o=this.traceArr,p=o.length,q="";for(k=0;p>k;k++)l=o[k],m=l.method,m?(n=l.args,q+=m,q+=j?h:c.Util._isArray(n[0])?e+n.join(a)+f:b+n.join(a)+d):(q+=l.property,j||(q+=i+l.val)),q+=g;return q},clearTrace:function(){this.traceArr=[]},_trace:function(a){var b,d=this.traceArr;d.push(a),b=d.length,b>=c.traceArrMax&&d.shift()},reset:function(){var a=this.getCanvas().getPixelRatio();this.setTransform(1*a,0,0,1*a,0,0)},getCanvas:function(){return this.canvas},clear:function(a){var b=this.getCanvas();a?this.clearRect(a.x||0,a.y||0,a.width||0,a.height||0):this.clearRect(0,0,b.getWidth(),b.getHeight())},_applyLineCap:function(a){var b=a.getLineCap();b&&this.setAttr("lineCap",b)},_applyOpacity:function(a){var b=a.getAbsoluteOpacity();1!==b&&this.setAttr("globalAlpha",b)},_applyLineJoin:function(a){var b=a.getLineJoin();b&&this.setAttr("lineJoin",b)},_applyTransform:function(a){var b,c=a.getTransformsEnabled();"all"===c?(b=a.getAbsoluteTransform().getMatrix(),this.transform(b[0],b[1],b[2],b[3],b[4],b[5])):"position"===c&&this.translate(a.getX(),a.getY())},setAttr:function(a,b){this._context[a]=b},arc:function(){var a=arguments;this._context.arc(a[0],a[1],a[2],a[3],a[4],a[5])},beginPath:function(){this._context.beginPath()},bezierCurveTo:function(){var a=arguments;this._context.bezierCurveTo(a[0],a[1],a[2],a[3],a[4],a[5])},clearRect:function(){var a=arguments;this._context.clearRect(a[0],a[1],a[2],a[3])},clip:function(){this._context.clip()},closePath:function(){this._context.closePath()},createImageData:function(){var a=arguments;return 2===a.length?this._context.createImageData(a[0],a[1]):1===a.length?this._context.createImageData(a[0]):void 0},createLinearGradient:function(){var a=arguments;return this._context.createLinearGradient(a[0],a[1],a[2],a[3])},createPattern:function(){var a=arguments;return this._context.createPattern(a[0],a[1])},createRadialGradient:function(){var a=arguments;return this._context.createRadialGradient(a[0],a[1],a[2],a[3],a[4],a[5])},drawImage:function(){var a=arguments,b=this._context;3===a.length?b.drawImage(a[0],a[1],a[2]):5===a.length?b.drawImage(a[0],a[1],a[2],a[3],a[4]):9===a.length&&b.drawImage(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8])},fill:function(){this._context.fill()},fillText:function(){var a=arguments;this._context.fillText(a[0],a[1],a[2])},getImageData:function(){var a=arguments;return this._context.getImageData(a[0],a[1],a[2],a[3])},lineTo:function(){var a=arguments;this._context.lineTo(a[0],a[1])},moveTo:function(){var a=arguments;this._context.moveTo(a[0],a[1])},rect:function(){var a=arguments;this._context.rect(a[0],a[1],a[2],a[3])},putImageData:function(){var a=arguments;this._context.putImageData(a[0],a[1],a[2])},quadraticCurveTo:function(){var a=arguments;this._context.quadraticCurveTo(a[0],a[1],a[2],a[3])},restore:function(){this._context.restore()},rotate:function(){var a=arguments;this._context.rotate(a[0])},save:function(){this._context.save()},scale:function(){var a=arguments;this._context.scale(a[0],a[1])},setLineDash:function(){var a=arguments,b=this._context;this._context.setLineDash?b.setLineDash(a[0]):"mozDash"in b?b.mozDash=a[0]:"webkitLineDash"in b&&(b.webkitLineDash=a[0])},setTransform:function(){var a=arguments;this._context.setTransform(a[0],a[1],a[2],a[3],a[4],a[5])},stroke:function(){this._context.stroke()},strokeText:function(){var a=arguments;this._context.strokeText(a[0],a[1],a[2])},transform:function(){var a=arguments;this._context.transform(a[0],a[1],a[2],a[3],a[4],a[5])},translate:function(){var a=arguments;this._context.translate(a[0],a[1])},_enableTrace:function(){var a,b,d=this,e=j.length,f=c.Util._simplifyArray,g=this.setAttr;for(a=0;e>a;a++)!function(a){var c,e=d[a];d[a]=function(){return b=f(Array.prototype.slice.call(arguments,0)),c=e.apply(d,arguments),d._trace({method:a,args:b}),c}}(j[a]);d.setAttr=function(){g.apply(d,arguments),d._trace({property:arguments[0],val:arguments[1]})}}},c.SceneContext=function(a){c.Context.call(this,a)},c.SceneContext.prototype={_fillColor:function(a){var b=a.fill()||c.Util._rgbToHex(a.fillRed(),a.fillGreen(),a.fillBlue());this.setAttr("fillStyle",b),a._fillFunc(this)},_fillPattern:function(a){var b=a.getFillPatternImage(),c=a.getFillPatternX(),d=a.getFillPatternY(),e=a.getFillPatternScale(),f=a.getFillPatternRotation(),g=a.getFillPatternOffset(),h=a.getFillPatternRepeat();(c||d)&&this.translate(c||0,d||0),f&&this.rotate(f),e&&this.scale(e.x,e.y),g&&this.translate(-1*g.x,-1*g.y),this.setAttr("fillStyle",this.createPattern(b,h||"repeat")),this.fill()},_fillLinearGradient:function(a){var b=a.getFillLinearGradientStartPoint(),c=a.getFillLinearGradientEndPoint(),d=a.getFillLinearGradientColorStops(),e=this.createLinearGradient(b.x,b.y,c.x,c.y);if(d){for(var f=0;f<d.length;f+=2)e.addColorStop(d[f],d[f+1]);this.setAttr("fillStyle",e),this.fill()}},_fillRadialGradient:function(a){for(var b=a.getFillRadialGradientStartPoint(),c=a.getFillRadialGradientEndPoint(),d=a.getFillRadialGradientStartRadius(),e=a.getFillRadialGradientEndRadius(),f=a.getFillRadialGradientColorStops(),g=this.createRadialGradient(b.x,b.y,d,c.x,c.y,e),h=0;h<f.length;h+=2)g.addColorStop(f[h],f[h+1]);this.setAttr("fillStyle",g),this.fill()},_fill:function(a){var b=a.fill()||a.fillRed()||a.fillGreen()||a.fillBlue(),c=a.getFillPatternImage(),d=a.getFillLinearGradientColorStops(),e=a.getFillRadialGradientColorStops(),f=a.getFillPriority();b&&"color"===f?this._fillColor(a):c&&"pattern"===f?this._fillPattern(a):d&&"linear-gradient"===f?this._fillLinearGradient(a):e&&"radial-gradient"===f?this._fillRadialGradient(a):b?this._fillColor(a):c?this._fillPattern(a):d?this._fillLinearGradient(a):e&&this._fillRadialGradient(a)},_stroke:function(a){var b=a.dash(),d=a.getStrokeScaleEnabled();a.hasStroke()&&(d||(this.save(),this.setTransform(1,0,0,1,0,0)),this._applyLineCap(a),b&&a.dashEnabled()&&this.setLineDash(b),this.setAttr("lineWidth",a.strokeWidth()),this.setAttr("strokeStyle",a.stroke()||c.Util._rgbToHex(a.strokeRed(),a.strokeGreen(),a.strokeBlue())),a._strokeFunc(this),d||this.restore())},_applyShadow:function(a){var b=c.Util,d=a.getAbsoluteOpacity(),e=b.get(a.getShadowColor(),"black"),f=b.get(a.getShadowBlur(),5),g=b.get(a.getShadowOpacity(),0),h=b.get(a.getShadowOffset(),{x:0,y:0});g&&this.setAttr("globalAlpha",g*d),this.setAttr("shadowColor",e),this.setAttr("shadowBlur",f),this.setAttr("shadowOffsetX",h.x),this.setAttr("shadowOffsetY",h.y)}},c.Util.extend(c.SceneContext,c.Context),c.HitContext=function(a){c.Context.call(this,a)},c.HitContext.prototype={_fill:function(a){this.save(),this.setAttr("fillStyle",a.colorKey),a._fillFuncHit(this),this.restore()},_stroke:function(a){a.hasStroke()&&(this._applyLineCap(a),this.setAttr("lineWidth",a.strokeWidth()),this.setAttr("strokeStyle",a.colorKey),a._strokeFuncHit(this))}},c.Util.extend(c.HitContext,c.Context)}(),function(){var a="get",b="set";c.Factory={addGetterSetter:function(a,b,c,d){this.addGetter(a,b,c),this.addSetter(a,b,d),this.addOverloadedGetterSetter(a,b)},addGetter:function(b,d,e){var f=a+c.Util._capitalize(d);b.prototype[f]=function(){var a=this.attrs[d];return void 0===a?e:a}},addSetter:function(a,d,e){var f=b+c.Util._capitalize(d);a.prototype[f]=function(a){return e&&(a=e.call(this,a)),this._setAttr(d,a),this}},addComponentsGetterSetter:function(d,e,f,g){var h,i,j=f.length,k=c.Util._capitalize,l=a+k(e),m=b+k(e);d.prototype[l]=function(){var a={};for(h=0;j>h;h++)i=f[h],a[i]=this.getAttr(e+k(i));return a},d.prototype[m]=function(a){var b,c=this.attrs[e];g&&(a=g.call(this,a));for(b in a)this._setAttr(e+k(b),a[b]);return this._fireChangeEvent(e,c,a),this},this.addOverloadedGetterSetter(d,e)},addOverloadedGetterSetter:function(d,e){var f=c.Util._capitalize(e),g=b+f,h=a+f;d.prototype[e]=function(){return arguments.length?(this[g](arguments[0]),this):this[h]()}},backCompat:function(a,b){var c;for(c in b)a.prototype[c]=a.prototype[b[c]]}}}(),function(){var a="absoluteOpacity",b="absoluteTransform",d="before",e="Change",f="children",g=".",h="",i="get",j="id",k="kinetic",l="listening",m="mouseenter",n="mouseleave",o="name",p="set",q="Shape",r=" ",s="stage",t="transform",u="Stage",v="visible",w=["xChange.kinetic","yChange.kinetic","scaleXChange.kinetic","scaleYChange.kinetic","skewXChange.kinetic","skewYChange.kinetic","rotationChange.kinetic","offsetXChange.kinetic","offsetYChange.kinetic","transformsEnabledChange.kinetic"].join(r);c.Util.addMethods(c.Node,{_init:function(d){var e=this;this._id=c.idCounter++,this.eventListeners={},this.attrs={},this._cache={},this._filterUpToDate=!1,this.setAttrs(d),this.on(w,function(){this._clearCache(t),e._clearSelfAndDescendantCache(b)}),this.on("visibleChange.kinetic",function(){e._clearSelfAndDescendantCache(v)}),this.on("listeningChange.kinetic",function(){e._clearSelfAndDescendantCache(l)}),this.on("opacityChange.kinetic",function(){e._clearSelfAndDescendantCache(a)})},_clearCache:function(a){a?delete this._cache[a]:this._cache={}},_getCache:function(a,b){var c=this._cache[a];return void 0===c&&(this._cache[a]=b.call(this)),this._cache[a]},_clearSelfAndDescendantCache:function(a){this._clearCache(a),this.children&&this.getChildren().each(function(b){b._clearSelfAndDescendantCache(a)})},clearCache:function(){return delete this._cache.canvas,this._filterUpToDate=!1,this},cache:function(a){var b,d=a||{},e=d.x||0,f=d.y||0,g=d.width||this.width(),h=d.height||this.height(),i=d.drawBorder||!1,j=new c.SceneCanvas({pixelRatio:1,width:g,height:h}),k=new c.SceneCanvas({pixelRatio:1,width:g,height:h}),l=new c.HitCanvas({width:g,height:h}),m=this.transformsEnabled(),n=this.x(),o=this.y();return this.clearCache(),this.transformsEnabled("position"),this.x(-1*e),this.y(-1*f),this.drawScene(j),this.drawHit(l),i&&(b=j.getContext(),b.save(),b.beginPath(),b.rect(0,0,g,h),b.closePath(),b.setAttr("strokeStyle","red"),b.setAttr("lineWidth",5),b.stroke(),b.restore()),this.x(n),this.y(o),this.transformsEnabled(m),this._cache.canvas={scene:j,filter:k,hit:l},this},_drawCachedSceneCanvas:function(a){a.save(),a._applyTransform(this),a.drawImage(this._getCachedSceneCanvas()._canvas,0,0),a.restore()},_getCachedSceneCanvas:function(){var a,b,d,e,f=this.filters(),g=this._cache.canvas,h=g.scene,i=g.filter,j=i.getContext();if(f){if(!this._filterUpToDate){try{for(a=f.length,j.clear(),j.drawImage(h._canvas,0,0),b=j.getImageData(0,0,i.getWidth(),i.getHeight()),d=0;a>d;d++)e=f[d],e.call(this,b),j.putImageData(b,0,0)}catch(k){c.Util.warn("Unable to apply filter. "+k.message)}this._filterUpToDate=!0}return i}return h},_drawCachedHitCanvas:function(a){var b=this._cache.canvas,c=b.hit;a.save(),a._applyTransform(this),a.drawImage(c._canvas,0,0),a.restore()},on:function(a,b){var c,d,e,f,i,j=a.split(r),k=j.length;for(c=0;k>c;c++)d=j[c],e=d.split(g),f=e[0],i=e[1]||h,this.eventListeners[f]||(this.eventListeners[f]=[]),this.eventListeners[f].push({name:i,handler:b});return this},off:function(a){var b,c,d,e,f,h,i=a.split(r),j=i.length;for(b=0;j>b;b++)if(d=i[b],e=d.split(g),f=e[0],h=e[1],f)this.eventListeners[f]&&this._off(f,h);else for(c in this.eventListeners)this._off(c,h);return this},remove:function(){var c=this.getParent();return c&&c.children&&(c.children.splice(this.index,1),c._setChildrenIndices(),delete this.parent),this._clearSelfAndDescendantCache(s),this._clearSelfAndDescendantCache(b),this._clearSelfAndDescendantCache(v),this._clearSelfAndDescendantCache(l),this._clearSelfAndDescendantCache(a),this},destroy:function(){c._removeId(this.getId()),c._removeName(this.getName(),this._id),this.remove()},getAttr:function(a){var b=i+c.Util._capitalize(a);return c.Util._isFunction(this[b])?this[b]():this.attrs[a]},getAncestors:function(){for(var a=this.getParent(),b=new c.Collection;a;)b.push(a),a=a.getParent();return b},getAttrs:function(){return this.attrs||{}},setAttrs:function(a){var b,d;if(a)for(b in a)b===f||(d=p+c.Util._capitalize(b),c.Util._isFunction(this[d])?this[d](a[b]):this._setAttr(b,a[b]));return this},isListening:function(){return this._getCache(l,this._isListening)},_isListening:function(){var a=this.getListening(),b=this.getParent();return"inherit"===a?b?b.isListening():!0:a},isVisible:function(){return this._getCache(v,this._isVisible)},_isVisible:function(){var a=this.getVisible(),b=this.getParent();return"inherit"===a?b?b.isVisible():!0:a},shouldDrawHit:function(){var a=this.getLayer();return a&&a.isHitGraphEnabled()&&this.isListening()&&this.isVisible()&&!c.isDragging()},show:function(){return this.setVisible(!0),this},hide:function(){return this.setVisible(!1),this},getZIndex:function(){return this.index||0},getAbsoluteZIndex:function(){function a(i){for(b=[],c=i.length,d=0;c>d;d++)e=i[d],h++,e.nodeType!==q&&(b=b.concat(e.getChildren().toArray())),e._id===g._id&&(d=c);b.length>0&&b[0].getDepth()<=f&&a(b)}var b,c,d,e,f=this.getDepth(),g=this,h=0;return g.nodeType!==u&&a(g.getStage().getChildren()),h},getDepth:function(){for(var a=0,b=this.parent;b;)a++,b=b.parent;return a},setPosition:function(a){return this.setX(a.x),this.setY(a.y),this},getPosition:function(){return{x:this.getX(),y:this.getY()}},getAbsolutePosition:function(){var a=this.getAbsoluteTransform().getMatrix(),b=new c.Transform,d=this.offset();return b.m=a.slice(),b.translate(d.x,d.y),b.getTranslation()},setAbsolutePosition:function(a){var b,c=this._clearTransform();return this.attrs.x=c.x,this.attrs.y=c.y,delete c.x,delete c.y,b=this.getAbsoluteTransform(),b.invert(),b.translate(a.x,a.y),a={x:this.attrs.x+b.getTranslation().x,y:this.attrs.y+b.getTranslation().y},this.setPosition({x:a.x,y:a.y}),this._setTransform(c),this},_setTransform:function(a){var c;for(c in a)this.attrs[c]=a[c];this._clearCache(t),this._clearSelfAndDescendantCache(b)},_clearTransform:function(){var a={x:this.getX(),y:this.getY(),rotation:this.getRotation(),scaleX:this.getScaleX(),scaleY:this.getScaleY(),offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),skewX:this.getSkewX(),skewY:this.getSkewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,this._clearCache(t),this._clearSelfAndDescendantCache(b),a},move:function(a){var b=a.x,c=a.y,d=this.getX(),e=this.getY();return void 0!==b&&(d+=b),void 0!==c&&(e+=c),this.setPosition({x:d,y:e}),this},_eachAncestorReverse:function(a,b){var c,d,e=[],f=this.getParent();for(b&&e.unshift(this);f;)e.unshift(f),f=f.parent;for(c=e.length,d=0;c>d;d++)a(e[d])},rotate:function(a){return this.setRotation(this.getRotation()+a),this},moveToTop:function(){var a=this.index;return this.parent.children.splice(a,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0},moveUp:function(){var a=this.index,b=this.parent.getChildren().length;return b-1>a?(this.parent.children.splice(a,1),this.parent.children.splice(a+1,0,this),this.parent._setChildrenIndices(),!0):!1},moveDown:function(){var a=this.index;return a>0?(this.parent.children.splice(a,1),this.parent.children.splice(a-1,0,this),this.parent._setChildrenIndices(),!0):!1},moveToBottom:function(){var a=this.index;return a>0?(this.parent.children.splice(a,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1},setZIndex:function(a){var b=this.index;return this.parent.children.splice(b,1),this.parent.children.splice(a,0,this),this.parent._setChildrenIndices(),this},getAbsoluteOpacity:function(){return this._getCache(a,this._getAbsoluteOpacity)},_getAbsoluteOpacity:function(){var a=this.getOpacity();return this.getParent()&&(a*=this.getParent().getAbsoluteOpacity()),a},moveTo:function(a){return c.Node.prototype.remove.call(this),a.add(this),this},toObject:function(){var a,b,d,e,f=c.Util,g={},h=this.getAttrs();g.attrs={};for(a in h)b=h[a],f._isFunction(b)||f._isElement(b)||f._isObject(b)&&f._hasMethods(b)||(d=this[i+c.Util._capitalize(a)],e=d?d.call({attrs:{}}):null,e!==b&&(g.attrs[a]=b));return g.className=this.getClassName(),g},toJSON:function(){return JSON.stringify(this.toObject())},getParent:function(){return this.parent},getLayer:function(){var a=this.getParent();return a?a.getLayer():null},getStage:function(){return this._getCache(s,this._getStage)},_getStage:function(){var a=this.getParent();return a?a.getStage():void 0},fire:function(a,b,c){return c?this._fireAndBubble(a,b||{}):this._fire(a,b||{}),this},getAbsoluteTransform:function(){return this._getCache(b,this._getAbsoluteTransform)},_getAbsoluteTransform:function(){var a,b,d=new c.Transform;return this._eachAncestorReverse(function(c){a=c.transformsEnabled(),b=c.getTransform(),"all"===a?d.multiply(b):"position"===a&&d.translate(c.x(),c.y())},!0),d},getTransform:function(){return this._getCache(t,this._getTransform)},_getTransform:function(){var a=new c.Transform,b=this.getX(),d=this.getY(),e=this.getRotation()*Math.PI/180,f=this.getScaleX(),g=this.getScaleY(),h=this.getSkewX(),i=this.getSkewY(),j=this.getOffsetX(),k=this.getOffsetY();return(0!==b||0!==d)&&a.translate(b,d),0!==e&&a.rotate(e),(0!==h||0!==i)&&a.skew(h,i),(1!==f||1!==g)&&a.scale(f,g),(0!==j||0!==k)&&a.translate(-1*j,-1*k),a},clone:function(a){var b,d,e,f,g,h=this.getClassName(),i=new c[h](this.attrs);for(b in this.eventListeners)for(d=this.eventListeners[b],e=d.length,f=0;e>f;f++)g=d[f],g.name.indexOf(k)<0&&(i.eventListeners[b]||(i.eventListeners[b]=[]),i.eventListeners[b].push(g));return i.setAttrs(a),i},toDataURL:function(a){a=a||{};var b=a.mimeType||null,d=a.quality||null,e=this.getStage(),f=a.x||0,g=a.y||0,h=new c.SceneCanvas({width:a.width||this.getWidth()||(e?e.getWidth():0),height:a.height||this.getHeight()||(e?e.getHeight():0),pixelRatio:1}),i=h.getContext();return i.save(),(f||g)&&i.translate(-1*f,-1*g),this.drawScene(h),i.restore(),h.toDataURL(b,d)},toImage:function(a){c.Util._getImage(this.toDataURL(a),function(b){a.callback(b)})},setSize:function(a){return this.setWidth(a.width),this.setHeight(a.height),this},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},getWidth:function(){return this.attrs.width||0},getHeight:function(){return this.attrs.height||0},getClassName:function(){return this.className||this.nodeType},getType:function(){return this.nodeType},_get:function(a){return this.nodeType===a?[this]:[]},_off:function(a,b){var c,d,e=this.eventListeners[a];for(c=0;c<e.length;c++)if(d=e[c].name,!("kinetic"===d&&"kinetic"!==b||b&&d!==b)){if(e.splice(c,1),0===e.length){delete this.eventListeners[a];break}c--}},_fireBeforeChangeEvent:function(a,b,f){this._fire([d,c.Util._capitalize(a),e].join(h),{oldVal:b,newVal:f})},_fireChangeEvent:function(a,b,c){this._fire(a+e,{oldVal:b,newVal:c})},setId:function(a){var b=this.getId();return c._removeId(b),c._addId(this,a),this._setAttr(j,a),this},setName:function(a){var b=this.getName();return c._removeName(b,this._id),c._addName(this,a),this._setAttr(o,a),this},setAttr:function(){var a=Array.prototype.slice.call(arguments),b=a[0],d=a[1],e=p+c.Util._capitalize(b),f=this[e];return c.Util._isFunction(f)?f.call(this,d):this._setAttr(b,d),this},_setAttr:function(a,b){var c;void 0!==b&&(c=this.attrs[a],this.attrs[a]=b,this._fireChangeEvent(a,c,b))},_setComponentAttr:function(a,b,c){var d;void 0!==c&&(d=this.attrs[a],d||(this.attrs[a]=this.getAttr(a)),this.attrs[a][b]=c,this._fireChangeEvent(a,d,c))},_fireAndBubble:function(a,b,c){var d=!0;b&&this.nodeType===q&&(b.targetNode=this),a===m&&c&&this._id===c._id?d=!1:a===n&&c&&this._id===c._id&&(d=!1),d&&(this._fire(a,b),b&&!b.cancelBubble&&this.parent&&(c&&c.parent?this._fireAndBubble.call(this.parent,a,b,c.parent):this._fireAndBubble.call(this.parent,a,b)))},_fire:function(a,b){var c,d=this.eventListeners[a];if(d)for(c=0;c<d.length;c++)d[c].handler.call(this,b)},draw:function(){return this.drawScene(),this.drawHit(),this}}),c.Node.create=function(a,b){return this._createNode(JSON.parse(a),b)},c.Node._createNode=function(a,b){var d,e,f,g=c.Node.prototype.getClassName.call(a),h=a.children;if(b&&(a.attrs.container=b),d=new c[g](a.attrs),h)for(e=h.length,f=0;e>f;f++)d.add(this._createNode(h[f]));return d},c.Factory.addOverloadedGetterSetter(c.Node,"position"),c.Factory.addGetterSetter(c.Node,"x",0),c.Factory.addGetterSetter(c.Node,"y",0),c.Factory.addGetterSetter(c.Node,"opacity",1),c.Factory.addGetter(c.Node,"name"),c.Factory.addOverloadedGetterSetter(c.Node,"name"),c.Factory.addGetter(c.Node,"id"),c.Factory.addOverloadedGetterSetter(c.Node,"id"),c.Factory.addGetterSetter(c.Node,"rotation",0),c.Factory.addComponentsGetterSetter(c.Node,"scale",["x","y"]),c.Factory.addGetterSetter(c.Node,"scaleX",1),c.Factory.addGetterSetter(c.Node,"scaleY",1),c.Factory.addComponentsGetterSetter(c.Node,"skew",["x","y"]),c.Factory.addGetterSetter(c.Node,"skewX",0),c.Factory.addGetterSetter(c.Node,"skewY",0),c.Factory.addComponentsGetterSetter(c.Node,"offset",["x","y"]),c.Factory.addGetterSetter(c.Node,"offsetX",0),c.Factory.addGetterSetter(c.Node,"offsetY",0),c.Factory.addSetter(c.Node,"width",0),c.Factory.addOverloadedGetterSetter(c.Node,"width"),c.Factory.addSetter(c.Node,"height",0),c.Factory.addOverloadedGetterSetter(c.Node,"height"),c.Factory.addGetterSetter(c.Node,"listening","inherit"),c.Factory.addGetterSetter(c.Node,"filters",void 0,function(a){return this._filterUpToDate=!1,a}),c.Factory.addGetterSetter(c.Node,"visible","inherit"),c.Factory.addGetterSetter(c.Node,"transformsEnabled","all"),c.Factory.backCompat(c.Node,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"}),c.Collection.mapMethods(["on","off","remove","destroy","show","hide","move","rotate","moveToTop","moveUp","moveDown","moveToBottom","moveTo","fire","draw"])}(),function(){c.Filters.Grayscale=function(a){var b,c,d=a.data,e=d.length;for(b=0;e>b;b+=4)c=.34*d[b]+.5*d[b+1]+.16*d[b+2],d[b]=c,d[b+1]=c,d[b+2]=c}}(),function(){c.Filters.Brighten=function(a){var b,c=255*this.brightness(),d=a.data,e=d.length;for(b=0;e>b;b+=4)d[b]+=c,d[b+1]+=c,d[b+2]+=c},c.Factory.addGetterSetter(c.Node,"brightness",0,function(a){return this._filterUpToDate=!1,a})}(),function(){c.Filters.Invert=function(a){var b,c=a.data,d=c.length;for(b=0;d>b;b+=4)c[b]=255-c[b],c[b+1]=255-c[b+1],c[b+2]=255-c[b+2]
}}(),function(){function a(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}function b(b,c){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D=b.data,E=b.width,F=b.height,G=c+c+1,H=E-1,I=F-1,J=c+1,K=J*(J+1)/2,L=new a,M=null,N=L,O=null,P=null,Q=d[c],R=e[c];for(h=1;G>h;h++)N=N.next=new a,h==J&&(M=N);for(N.next=L,l=k=0,g=0;F>g;g++){for(u=v=w=x=m=n=o=p=0,q=J*(y=D[k]),r=J*(z=D[k+1]),s=J*(A=D[k+2]),t=J*(B=D[k+3]),m+=K*y,n+=K*z,o+=K*A,p+=K*B,N=L,h=0;J>h;h++)N.r=y,N.g=z,N.b=A,N.a=B,N=N.next;for(h=1;J>h;h++)i=k+((h>H?H:h)<<2),m+=(N.r=y=D[i])*(C=J-h),n+=(N.g=z=D[i+1])*C,o+=(N.b=A=D[i+2])*C,p+=(N.a=B=D[i+3])*C,u+=y,v+=z,w+=A,x+=B,N=N.next;for(O=L,P=M,f=0;E>f;f++)D[k+3]=B=p*Q>>R,0!==B?(B=255/B,D[k]=(m*Q>>R)*B,D[k+1]=(n*Q>>R)*B,D[k+2]=(o*Q>>R)*B):D[k]=D[k+1]=D[k+2]=0,m-=q,n-=r,o-=s,p-=t,q-=O.r,r-=O.g,s-=O.b,t-=O.a,i=l+((i=f+c+1)<H?i:H)<<2,u+=O.r=D[i],v+=O.g=D[i+1],w+=O.b=D[i+2],x+=O.a=D[i+3],m+=u,n+=v,o+=w,p+=x,O=O.next,q+=y=P.r,r+=z=P.g,s+=A=P.b,t+=B=P.a,u-=y,v-=z,w-=A,x-=B,P=P.next,k+=4;l+=E}for(f=0;E>f;f++){for(v=w=x=u=n=o=p=m=0,k=f<<2,q=J*(y=D[k]),r=J*(z=D[k+1]),s=J*(A=D[k+2]),t=J*(B=D[k+3]),m+=K*y,n+=K*z,o+=K*A,p+=K*B,N=L,h=0;J>h;h++)N.r=y,N.g=z,N.b=A,N.a=B,N=N.next;for(j=E,h=1;c>=h;h++)k=j+f<<2,m+=(N.r=y=D[k])*(C=J-h),n+=(N.g=z=D[k+1])*C,o+=(N.b=A=D[k+2])*C,p+=(N.a=B=D[k+3])*C,u+=y,v+=z,w+=A,x+=B,N=N.next,I>h&&(j+=E);for(k=f,O=L,P=M,g=0;F>g;g++)i=k<<2,D[i+3]=B=p*Q>>R,B>0?(B=255/B,D[i]=(m*Q>>R)*B,D[i+1]=(n*Q>>R)*B,D[i+2]=(o*Q>>R)*B):D[i]=D[i+1]=D[i+2]=0,m-=q,n-=r,o-=s,p-=t,q-=O.r,r-=O.g,s-=O.b,t-=O.a,i=f+((i=g+J)<I?i:I)*E<<2,m+=u+=O.r=D[i],n+=v+=O.g=D[i+1],o+=w+=O.b=D[i+2],p+=x+=O.a=D[i+3],O=O.next,q+=y=P.r,r+=z=P.g,s+=A=P.b,t+=B=P.a,u-=y,v-=z,w-=A,x-=B,P=P.next,k+=E}}var d=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],e=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];c.Filters.Blur=function(a){var c=0|this.blurRadius();c>0&&b(a,c)},c.Factory.addGetterSetter(c.Node,"blurRadius",0,function(a){return this._filterUpToDate=!1,a})}(),function(){function a(a,b,c){var d=4*(c*a.width+b),e=[];return e.push(a.data[d++],a.data[d++],a.data[d++],a.data[d++]),e}function b(a,b){return Math.sqrt(Math.pow(a[0]-b[0],2)+Math.pow(a[1]-b[1],2)+Math.pow(a[2]-b[2],2))}function d(a){for(var b=[0,0,0],c=0;c<a.length;c++)b[0]+=a[c][0],b[1]+=a[c][1],b[2]+=a[c][2];return b[0]/=a.length,b[1]/=a.length,b[2]/=a.length,b}function e(c,e){var f=a(c,0,0),g=a(c,c.width-1,0),h=a(c,0,c.height-1),i=a(c,c.width-1,c.height-1),j=e||10;if(b(f,g)<j&&b(g,i)<j&&b(i,h)<j&&b(h,f)<j){for(var k=d([g,f,i,h]),l=[],m=0;m<c.width*c.height;m++){var n=b(k,[c.data[4*m],c.data[4*m+1],c.data[4*m+2]]);l[m]=j>n?0:255}return l}}function f(a,b){for(var c=0;c<a.width*a.height;c++)a.data[4*c+3]=b[c]}function g(a,b,c){for(var d=[1,1,1,1,0,1,1,1,1],e=Math.round(Math.sqrt(d.length)),f=Math.floor(e/2),g=[],h=0;c>h;h++)for(var i=0;b>i;i++){for(var j=h*b+i,k=0,l=0;e>l;l++)for(var m=0;e>m;m++){var n=h+l-f,o=i+m-f;if(n>=0&&c>n&&o>=0&&b>o){var p=n*b+o,q=d[l*e+m];k+=a[p]*q}}g[j]=2040===k?255:0}return g}function h(a,b,c){for(var d=[1,1,1,1,1,1,1,1,1],e=Math.round(Math.sqrt(d.length)),f=Math.floor(e/2),g=[],h=0;c>h;h++)for(var i=0;b>i;i++){for(var j=h*b+i,k=0,l=0;e>l;l++)for(var m=0;e>m;m++){var n=h+l-f,o=i+m-f;if(n>=0&&c>n&&o>=0&&b>o){var p=n*b+o,q=d[l*e+m];k+=a[p]*q}}g[j]=k>=1020?255:0}return g}function i(a,b,c){for(var d=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9],e=Math.round(Math.sqrt(d.length)),f=Math.floor(e/2),g=[],h=0;c>h;h++)for(var i=0;b>i;i++){for(var j=h*b+i,k=0,l=0;e>l;l++)for(var m=0;e>m;m++){var n=h+l-f,o=i+m-f;if(n>=0&&c>n&&o>=0&&b>o){var p=n*b+o,q=d[l*e+m];k+=a[p]*q}}g[j]=k}return g}c.Filters.Mask=function(a){var b=this.threshold(),c=e(a,b);return c&&(c=g(c,a.width,a.height),c=h(c,a.width,a.height),c=i(c,a.width,a.height),f(a,c)),a},c.Factory.addGetterSetter(c.Node,"threshold",0,function(a){return this._filterUpToDate=!1,a})}(),function(){c.Filters.RGB=function(a){var b,c,d=a.data,e=d.length,f=this.red(),g=this.green(),h=this.blue();for(b=0;e>b;b+=4)c=(.34*d[b]+.5*d[b+1]+.16*d[b+2])/255,d[b]=c*f,d[b+1]=c*g,d[b+2]=c*h,d[b+3]=d[b+3]},c.Factory.addGetterSetter(c.Node,"red",0,function(a){return this._filterUpToDate=!1,a>255?255:0>a?0:Math.round(a)}),c.Factory.addGetterSetter(c.Node,"green",0,function(a){return this._filterUpToDate=!1,a>255?255:0>a?0:Math.round(a)}),c.Factory.addGetterSetter(c.Node,"blue",0,function(a){return this._filterUpToDate=!1,a>255?255:0>a?0:Math.round(a)})}(),function(){c.Filters.HSV=function(a){var b,c,d,e,f,g=a.data,h=g.length,i=this.value(),j=this.saturation(),k=Math.abs(this.hue()+360)%360,l=i*j*Math.cos(k*Math.PI/180),m=i*j*Math.sin(k*Math.PI/180),n=.299*i+.701*l+.167*m,o=.587*i-.587*l+.33*m,p=.114*i-.114*l-.497*m,q=.299*i-.299*l-.328*m,r=.587*i+.413*l+.035*m,s=.114*i-.114*l+.293*m,t=.299*i-.3*l+1.25*m,u=.587*i-.586*l-1.05*m,v=.114*i+.886*l-.2*m;for(b=0;h>b;b+=4)c=g[b+0],d=g[b+1],e=g[b+2],f=g[b+3],g[b+0]=n*c+o*d+p*e,g[b+1]=q*c+r*d+s*e,g[b+2]=t*c+u*d+v*e,g[b+3]=f},c.Factory.addGetterSetter(c.Node,"hue",0,function(a){return this._filterUpToDate=!1,a}),c.Factory.addGetterSetter(c.Node,"saturation",1,function(a){return this._filterUpToDate=!1,a}),c.Factory.addGetterSetter(c.Node,"value",1,function(a){return this._filterUpToDate=!1,a})}(),function(){c.Filters.Emboss=function(a){var b=10*this.embossStrength(),c=255*this.embossWhiteLevel(),d=this.embossDirection(),e=this.embossBlend(),f=0,g=0,h=a.data,i=a.width,j=a.height,k=4*i,l=j;switch(d){case"top-left":f=-1,g=-1;break;case"top":f=-1,g=0;break;case"top-right":f=-1,g=1;break;case"right":f=0,g=1;break;case"bottom-right":f=1,g=1;break;case"bottom":f=1,g=0;break;case"bottom-left":f=1,g=-1;break;case"left":f=0,g=-1}do{var m=(l-1)*k,n=f;1>l+n&&(n=0),l+n>j&&(n=0);var o=4*(l-1+n)*i,p=i;do{var q=m+4*(p-1),r=g;1>p+r&&(r=0),p+r>i&&(r=0);var s=o+4*(p-1+r),t=h[q]-h[s],u=h[q+1]-h[s+1],v=h[q+2]-h[s+2],w=t,x=w>0?w:-w,y=u>0?u:-u,z=v>0?v:-v;if(y>x&&(w=u),z>x&&(w=v),w*=b,e){var A=h[q]+w,B=h[q+1]+w,C=h[q+2]+w;h[q]=A>255?255:0>A?0:A,h[q+1]=B>255?255:0>B?0:B,h[q+2]=C>255?255:0>C?0:C}else{var D=c-w;0>D?D=0:D>255&&(D=255),h[q]=h[q+1]=h[q+2]=D}}while(--p)}while(--l)},c.Factory.addGetterSetter(c.Node,"embossStrength",.5,function(a){return this._filterUpToDate=!1,a}),c.Factory.addGetterSetter(c.Node,"embossWhiteLevel",.5,function(a){return this._filterUpToDate=!1,a}),c.Factory.addGetterSetter(c.Node,"embossDirection","top-left",function(a){return this._filterUpToDate=!1,a}),c.Factory.addGetterSetter(c.Node,"embossBlend",!1,function(a){return this._filterUpToDate=!1,a})}(),function(){function a(a,b,c,d,e){var f,g=c-b,h=e-d;return 0===g?d+h/2:0===h?d:(f=(a-b)/g,f=h*f+d)}c.Filters.Enhance=function(b){var c,d,e,f,g=b.data,h=g.length,i=g[0],j=i,k=g[1],l=k,m=g[2],n=m,o=g[3],p=o,q=this.enhance();if(0!==q){for(f=0;h>f;f+=4)c=g[f+0],i>c?i=c:c>j&&(j=c),d=g[f+1],k>d?k=d:d>l&&(l=d),e=g[f+2],m>e?m=e:e>n&&(n=e);j===i&&(j=255,i=0),l===k&&(l=255,k=0),n===m&&(n=255,m=0),p===o&&(p=255,o=0);var r,s,t,u,v,w,x,y,z,A,B,C;for(q>0?(s=j+q*(255-j),t=i-q*(i-0),v=l+q*(255-l),w=k-q*(k-0),y=n+q*(255-n),C=m-q*(m-0),B=p+q*(255-p),z=o-q*(o-0)):(r=.5*(j+i),s=j+q*(j-r),t=i+q*(i-r),u=.5*(l+k),v=l+q*(l-u),w=k+q*(k-u),x=.5*(n+m),y=n+q*(n-x),C=m+q*(m-x),A=.5*(p+o),B=p+q*(p-A),z=o+q*(o-A)),f=0;h>f;f+=4)g[f+0]=a(g[f+0],i,j,t,s),g[f+1]=a(g[f+1],k,l,w,v),g[f+2]=a(g[f+2],m,n,C,y)}},c.Factory.addGetterSetter(c.Node,"enhance",0,function(a){return this._filterUpToDate=!1,a})}(),function(){c.Filters.Posterize=function(a){var b,c=Math.round(254*this.levels())+1,d=a.data,e=d.length,f=255/c;for(b=0;e>b;b+=1)d[b]=Math.floor(d[b]/f)*f},c.Factory.addGetterSetter(c.Node,"levels",.5,function(a){return this._filterUpToDate=!1,a})}(),function(){c.Filters.Noise=function(a){var b,c=255*this.noise(),d=a.data,e=d.length,f=c/2;for(b=0;e>b;b+=4)d[b+0]+=f-2*f*Math.random(),d[b+1]+=f-2*f*Math.random(),d[b+2]+=f-2*f*Math.random()},c.Factory.addGetterSetter(c.Node,"noise",.2,function(a){return this._filterUpToDate=!1,a})}(),function(){c.Filters.Pixelate=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p=Math.ceil(this.pixelSize()),q=a.width,r=a.height,a=a.data,s=Math.ceil(q/p),t=Math.ceil(r/p);for(m=0;s>m;m+=1)for(n=0;t>n;n+=1){for(e=0,f=0,g=0,h=0,i=m*p,j=i+p,k=n*p,l=k+p,o=0,b=i;j>b;b+=1)if(!(b>=q))for(c=k;l>c;c+=1)c>=r||(d=4*(q*c+b),e+=a[d+0],f+=a[d+1],g+=a[d+2],h+=a[d+3],o+=1);for(e/=o,f/=o,g/=o,alphas=h/o,b=i;j>b;b+=1)if(!(b>=q))for(c=k;l>c;c+=1)c>=r||(d=4*(q*c+b),a[d+0]=e,a[d+1]=f,a[d+2]=g,a[d+3]=h)}},c.Factory.addGetterSetter(c.Node,"pixelSize",8,function(a){return this._filterUpToDate=!1,a})}(),function(){c.Filters.Threshold=function(a){var b,c=255*this.threshold(),d=a.data,e=d.length;for(b=0;e>b;b+=1)d[b]=d[b]<c?0:255},c.Factory.addGetterSetter(c.Node,"threshold",.5,function(a){return this._filterUpToDate=!1,a})}(),function(){c.Filters.Sepia=function(a){var b,c,d,e,f,g,h,i,j,k=a.data,l=a.width,m=a.height,n=4*l;do{b=(m-1)*n,c=l;do d=b+4*(c-1),e=k[d],f=k[d+1],g=k[d+2],h=.393*e+.769*f+.189*g,i=.349*e+.686*f+.168*g,j=.272*e+.534*f+.131*g,k[d]=h>255?255:h,k[d+1]=i>255?255:i,k[d+2]=j>255?255:j,k[d+3]=k[d+3];while(--c)}while(--m)}}(),function(){c.Filters.Solarize=function(a){var b=a.data,c=a.width,d=a.height,e=4*c,f=d;do{var g=(f-1)*e,h=c;do{var i=g+4*(h-1),j=b[i],k=b[i+1],l=b[i+2];j>127&&(j=255-j),k>127&&(k=255-k),l>127&&(l=255-l),b[i]=j,b[i+1]=k,b[i+2]=l}while(--h)}while(--f)}}(),function(){var a=function(a,b,c){var d,e,f,g,h=a.data,i=b.data,j=a.width,k=a.height,l=c.polarCenterX||j/2,m=c.polarCenterY||k/2,n=0,o=0,p=0,q=0,r=Math.sqrt(l*l+m*m);e=j-l,f=k-m,g=Math.sqrt(e*e+f*f),r=g>r?g:r;var s,t,u,v,w,x,y,z,A,B,C,D,E,F=k,G=j,H=360/G*Math.PI/180;for(t=0;G>t;t+=1)for(u=Math.sin(t*H),v=Math.cos(t*H),s=0;F>s;s+=1)e=l+r*s/F*v,f=m+r*s/F*u,1>=e&&(e=1),e>=j-.5&&(e=j-1),1>=f&&(f=1),f>=k-.5&&(f=k-1),w=e-.5,x=e+.5,y=Math.floor(w),z=Math.floor(x),A=f-.5,B=f+.5,C=Math.floor(A),D=Math.floor(B),E=(1-(w-y))*(1-(A-C)),d=4*(C*j+y),n=h[d+0]*E,o=h[d+1]*E,p=h[d+2]*E,q=h[d+3]*E,E=(1-(w-y))*(B-D),d=4*(D*j+y),n+=h[d+0]*E,o+=h[d+1]*E,p+=h[d+2]*E,q+=h[d+3]*E,E=(x-z)*(B-D),d=4*(D*j+z),n+=h[d+0]*E,o+=h[d+1]*E,p+=h[d+2]*E,q+=h[d+3]*E,E=(x-z)*(1-(A-C)),d=4*(C*j+z),n+=h[d+0]*E,o+=h[d+1]*E,p+=h[d+2]*E,q+=h[d+3]*E,d=4*(t+s*j),i[d+0]=n,i[d+1]=o,i[d+2]=p,i[d+3]=q},b=function(a,b,c){var d,e,f,g,h,i,j=a.data,k=b.data,l=a.width,m=a.height,n=c.polarCenterX||l/2,o=c.polarCenterY||m/2,p=0,q=0,r=0,s=0,t=Math.sqrt(n*n+o*o);e=l-n,f=m-o,i=Math.sqrt(e*e+f*f),t=i>t?i:t;var u,v,w=m,x=l,y=c.polarRotation||0;180*(x/360)/Math.PI;var z,A,B,C,D,E,F,G,H;for(e=0;l>e;e+=1)for(f=0;m>f;f+=1)g=e-n,h=f-o,u=Math.sqrt(g*g+h*h)*w/t,v=(180*Math.atan2(h,g)/Math.PI+360+y)%360,v=v*x/360,z=v-.5,A=v+.5,B=Math.floor(z),C=Math.floor(A),D=u-.5,E=u+.5,F=Math.floor(D),G=Math.floor(E),H=(1-(z-B))*(1-(D-F)),d=4*(F*l+B),p=j[d+0]*H,q=j[d+1]*H,r=j[d+2]*H,s=j[d+3]*H,H=(1-(z-B))*(E-G),d=4*(G*l+B),p+=j[d+0]*H,q+=j[d+1]*H,r+=j[d+2]*H,s+=j[d+3]*H,H=(A-C)*(E-G),d=4*(G*l+C),p+=j[d+0]*H,q+=j[d+1]*H,r+=j[d+2]*H,s+=j[d+3]*H,H=(A-C)*(1-(D-F)),d=4*(F*l+C),p+=j[d+0]*H,q+=j[d+1]*H,r+=j[d+2]*H,s+=j[d+3]*H,d=4*(f*l+e),k[d+0]=p,k[d+1]=q,k[d+2]=r,k[d+3]=s},d=document.createElement("canvas");c.Filters.Kaleidoscope=function(c){var e=c.width,f=c.height,g=Math.round(this.kaleidoscopePower()),h=Math.round(this.kaleidoscopeAngle()),i=Math.floor(e*(h%360)/360);if(!(1>g)){d.width=e,d.height=f;var j=d.getContext("2d").getImageData(0,0,e,f);a(c,j,{polarCenterX:e/2,polarCenterY:f/2});for(var k=e/Math.pow(2,g);8>=k;)k=2*k,g-=1;k=Math.ceil(k);var l=k,m=0,n=l,o=1;for(i+k>e&&(m=l,n=0,o=-1),q=0;f>q;q+=1)for(p=m;p!==n;p+=o)r=Math.round(p+i)%e,x=4*(e*q+r),t=j.data[x+0],u=j.data[x+1],v=j.data[x+2],w=j.data[x+3],y=4*(e*q+p),j.data[y+0]=t,j.data[y+1]=u,j.data[y+2]=v,j.data[y+3]=w;var p,q,r,s,t,u,v,w,x,y;for(q=0;f>q;q+=1)for(l=Math.floor(k),s=0;g>s;s+=1){for(p=0;l+1>p;p+=1)x=4*(e*q+p),t=j.data[x+0],u=j.data[x+1],v=j.data[x+2],w=j.data[x+3],y=4*(e*q+2*l-p-1),j.data[y+0]=t,j.data[y+1]=u,j.data[y+2]=v,j.data[y+3]=w;l*=2}b(j,c,{polarRotation:0})}},c.Factory.addGetterSetter(c.Node,"kaleidoscopePower",2,function(a){return this._filterUpToDate=!1,a}),c.Factory.addGetterSetter(c.Node,"kaleidoscopeAngle",0,function(a){return this._filterUpToDate=!1,a})}(),function(){function b(b){a.setTimeout(b,1e3/60)}var d=500;c.Animation=function(a,b){this.func=a,this.setLayers(b),this.id=c.Animation.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:(new Date).getTime()}},c.Animation.prototype={setLayers:function(a){var b=[];b=a?a.length>0?a:[a]:[],this.layers=b},getLayers:function(){return this.layers},addLayer:function(a){var b,c,d=this.layers;if(d){for(b=d.length,c=0;b>c;c++)if(d[c]._id===a._id)return!1}else this.layers=[];return this.layers.push(a),!0},isRunning:function(){for(var a=c.Animation,b=a.animations,d=0;d<b.length;d++)if(b[d].id===this.id)return!0;return!1},start:function(){this.stop(),this.frame.timeDiff=0,this.frame.lastTime=(new Date).getTime(),c.Animation._addAnimation(this)},stop:function(){c.Animation._removeAnimation(this)},_updateFrameObject:function(a){this.frame.timeDiff=a-this.frame.lastTime,this.frame.lastTime=a,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}},c.Animation.animations=[],c.Animation.animIdCounter=0,c.Animation.animRunning=!1,c.Animation._addAnimation=function(a){this.animations.push(a),this._handleAnimation()},c.Animation._removeAnimation=function(a){for(var b=a.id,c=this.animations,d=c.length,e=0;d>e;e++)if(c[e].id===b){this.animations.splice(e,1);break}},c.Animation._runFrames=function(){var a,b,c,d,e,f,g,h,i={},j=this.animations;for(d=0;d<j.length;d++){for(a=j[d],b=a.layers,c=a.func,a._updateFrameObject((new Date).getTime()),f=b.length,e=0;f>e;e++)g=b[e],void 0!==g._id&&(i[g._id]=g);c&&c.call(a,a.frame)}for(h in i)i[h].draw()},c.Animation._animationLoop=function(){var a=this;this.animations.length>0?(this._runFrames(),c.Animation.requestAnimFrame(function(){a._animationLoop()})):this.animRunning=!1},c.Animation._handleAnimation=function(){var a=this;this.animRunning||(this.animRunning=!0,a._animationLoop())};var e=function(){return a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||b}();c.Animation.requestAnimFrame=function(a){var d=c.isDragging?b:e;d(a)};var f=c.Node.prototype.moveTo;c.Node.prototype.moveTo=function(a){f.call(this,a)},c.Layer.prototype.batchDraw=function(){var a=this;this.batchAnim||(this.batchAnim=new c.Animation(function(){a.lastBatchDrawTime&&(new Date).getTime()-a.lastBatchDrawTime>d&&a.batchAnim.stop()},this)),this.lastBatchDrawTime=(new Date).getTime(),this.batchAnim.isRunning()||(this.draw(),this.batchAnim.start())},c.Stage.prototype.batchDraw=function(){this.getChildren().each(function(a){a.batchDraw()})}}(),function(){var a={node:1,duration:1,easing:1,onFinish:1,yoyo:1},b=1,d=2,e=3,f=0;c.Tween=function(b){var d,e=this,h=b.node,i=h._id,j=b.duration||1,k=b.easing||c.Easings.Linear,l=!!b.yoyo;this.node=h,this._id=f++,this.anim=new c.Animation(function(){e.tween.onEnterFrame()},h.getLayer()||h.getLayers()),this.tween=new g(d,function(a){e._tweenFunc(a)},k,0,1,1e3*j,l),this._addListeners(),c.Tween.attrs[i]||(c.Tween.attrs[i]={}),c.Tween.attrs[i][this._id]||(c.Tween.attrs[i][this._id]={}),c.Tween.tweens[i]||(c.Tween.tweens[i]={});for(d in b)void 0===a[d]&&this._addAttr(d,b[d]);this.reset(),this.onFinish=b.onFinish,this.onReset=b.onReset},c.Tween.attrs={},c.Tween.tweens={},c.Tween.prototype={_addAttr:function(a,b){var d,e,f,g,h,i=this.node,j=i._id;if(f=c.Tween.tweens[j][a],f&&delete c.Tween.attrs[j][f][a],d=i.getAttr(a),c.Util._isArray(b))for(e=[],h=b.length,g=0;h>g;g++)e.push(b[g]-d[g]);else e=b-d;c.Tween.attrs[j][this._id][a]={start:d,diff:e},c.Tween.tweens[j][a]=this._id},_tweenFunc:function(a){var b,d,e,f,g,h,i,j=this.node,k=c.Tween.attrs[j._id][this._id];for(b in k){if(d=k[b],e=d.start,f=d.diff,c.Util._isArray(e))for(g=[],i=e.length,h=0;i>h;h++)g.push(e[h]+f[h]*a);else g=e+f*a;j.setAttr(b,g)}},_addListeners:function(){var a=this;this.tween.onPlay=function(){a.anim.start()},this.tween.onReverse=function(){a.anim.start()},this.tween.onPause=function(){a.anim.stop()},this.tween.onFinish=function(){a.onFinish&&a.onFinish()},this.tween.onReset=function(){a.onReset&&a.onReset()}},play:function(){return this.tween.play(),this},reverse:function(){return this.tween.reverse(),this},reset:function(){var a=this.node;return this.tween.reset(),(a.getLayer()||a.getLayers()).draw(),this},seek:function(a){var b=this.node;return this.tween.seek(1e3*a),(b.getLayer()||b.getLayers()).draw(),this},pause:function(){return this.tween.pause(),this},finish:function(){var a=this.node;return this.tween.finish(),(a.getLayer()||a.getLayers()).draw(),this},destroy:function(){var a,b=this.node._id,d=this._id,e=c.Tween.tweens[b];this.pause();for(a in e)delete c.Tween.tweens[b][a];delete c.Tween.attrs[b][d]}};var g=function(a,b,c,d,e,f,g){this.prop=a,this.propFunc=b,this.begin=d,this._pos=d,this.duration=f,this._change=0,this.prevPos=0,this.yoyo=g,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=c,this._change=e-this.begin,this.pause()};g.prototype={fire:function(a){var b=this[a];b&&b()},setTime:function(a){a>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():0>a?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=a,this.update())},getTime:function(){return this._time},setPosition:function(a){this.prevPos=this._pos,this.propFunc(a),this._pos=a},getPosition:function(a){return void 0===a&&(a=this._time),this.func(a,this.begin,this._change,this.duration)},play:function(){this.state=d,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")},reverse:function(){this.state=e,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")},seek:function(a){this.pause(),this._time=a,this.update(),this.fire("onSeek")},reset:function(){this.pause(),this._time=0,this.update(),this.fire("onReset")},finish:function(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")},update:function(){this.setPosition(this.getPosition(this._time))},onEnterFrame:function(){var a=this.getTimer()-this._startTime;this.state===d?this.setTime(a):this.state===e&&this.setTime(this.duration-a)},pause:function(){this.state=b,this.fire("onPause")},getTimer:function(){return(new Date).getTime()}},c.Easings={BackEaseIn:function(a,b,c,d){var e=1.70158;return c*(a/=d)*a*((e+1)*a-e)+b},BackEaseOut:function(a,b,c,d){var e=1.70158;return c*((a=a/d-1)*a*((e+1)*a+e)+1)+b},BackEaseInOut:function(a,b,c,d){var e=1.70158;return(a/=d/2)<1?c/2*a*a*(((e*=1.525)+1)*a-e)+b:c/2*((a-=2)*a*(((e*=1.525)+1)*a+e)+2)+b},ElasticEaseIn:function(a,b,c,d,e,f){var g=0;return 0===a?b:1==(a/=d)?b+c:(f||(f=.3*d),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),-(e*Math.pow(2,10*(a-=1))*Math.sin(2*(a*d-g)*Math.PI/f))+b)},ElasticEaseOut:function(a,b,c,d,e,f){var g=0;return 0===a?b:1==(a/=d)?b+c:(f||(f=.3*d),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),e*Math.pow(2,-10*a)*Math.sin(2*(a*d-g)*Math.PI/f)+c+b)},ElasticEaseInOut:function(a,b,c,d,e,f){var g=0;return 0===a?b:2==(a/=d/2)?b+c:(f||(f=.3*d*1.5),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),1>a?-.5*e*Math.pow(2,10*(a-=1))*Math.sin(2*(a*d-g)*Math.PI/f)+b:.5*e*Math.pow(2,-10*(a-=1))*Math.sin(2*(a*d-g)*Math.PI/f)+c+b)},BounceEaseOut:function(a,b,c,d){return(a/=d)<1/2.75?7.5625*c*a*a+b:2/2.75>a?c*(7.5625*(a-=1.5/2.75)*a+.75)+b:2.5/2.75>a?c*(7.5625*(a-=2.25/2.75)*a+.9375)+b:c*(7.5625*(a-=2.625/2.75)*a+.984375)+b},BounceEaseIn:function(a,b,d,e){return d-c.Easings.BounceEaseOut(e-a,0,d,e)+b},BounceEaseInOut:function(a,b,d,e){return e/2>a?.5*c.Easings.BounceEaseIn(2*a,0,d,e)+b:.5*c.Easings.BounceEaseOut(2*a-e,0,d,e)+.5*d+b},EaseIn:function(a,b,c,d){return c*(a/=d)*a+b},EaseOut:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},EaseInOut:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b},StrongEaseIn:function(a,b,c,d){return c*(a/=d)*a*a*a*a+b},StrongEaseOut:function(a,b,c,d){return c*((a=a/d-1)*a*a*a*a+1)+b},StrongEaseInOut:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a*a*a*a+b:c/2*((a-=2)*a*a*a*a+2)+b},Linear:function(a,b,c,d){return c*a/d+b}}}(),function(){c.DD={anim:new c.Animation,isDragging:!1,offset:{x:0,y:0},node:null,_drag:function(a){var b=c.DD,d=b.node;d&&(d._setDragPosition(a),b.isDragging||(b.isDragging=!0,d.fire("dragstart",a,!0)),d.fire("dragmove",a,!0))},_endDragBefore:function(a){var b,d,e=c.DD,f=e.node;f&&(b=f.nodeType,d=f.getLayer(),e.anim.stop(),e.isDragging&&(e.isDragging=!1,c.listenClickTap=!1,a&&(a.dragEndNode=f)),delete e.node,(d||f).draw())},_endDragAfter:function(a){a=a||{};var b=a.dragEndNode;a&&b&&b.fire("dragend",a,!0)}},c.Node.prototype.startDrag=function(){var a=c.DD,b=this.getStage(),d=this.getLayer(),e=b.getPointerPosition(),f=this.getAbsolutePosition();e&&(a.node&&a.node.stopDrag(),a.node=this,a.offset.x=e.x-f.x,a.offset.y=e.y-f.y,a.anim.setLayers(d||this.getLayers()),a.anim.start(),this._setDragPosition())},c.Node.prototype._setDragPosition=function(a){var b=c.DD,d=this.getStage().getPointerPosition(),e=this.getDragBoundFunc(),f={x:d.x-b.offset.x,y:d.y-b.offset.y};void 0!==e&&(f=e.call(this,f,a)),this.setAbsolutePosition(f)},c.Node.prototype.stopDrag=function(){var a=c.DD,b={};a._endDragBefore(b),a._endDragAfter(b)},c.Node.prototype.setDraggable=function(a){this._setAttr("draggable",a),this._dragChange()};var a=c.Node.prototype.destroy;c.Node.prototype.destroy=function(){var b=c.DD;b.node&&b.node._id===this._id&&this.stopDrag(),a.call(this)},c.Node.prototype.isDragging=function(){var a=c.DD;return a.node&&a.node._id===this._id&&a.isDragging},c.Node.prototype._listenDrag=function(){var a=this;this._dragCleanup(),"Stage"===this.getClassName()?this.on("contentMousedown.kinetic contentTouchstart.kinetic",function(b){c.DD.node||a.startDrag(b)}):this.on("mousedown.kinetic touchstart.kinetic",function(b){c.DD.node||a.startDrag(b)})},c.Node.prototype._dragChange=function(){if(this.attrs.draggable)this._listenDrag();else{this._dragCleanup();var a=this.getStage(),b=c.DD;a&&b.node&&b.node._id===this._id&&b.node.stopDrag()}},c.Node.prototype._dragCleanup=function(){"Stage"===this.getClassName()?(this.off("contentMousedown.kinetic"),this.off("contentTouchstart.kinetic")):(this.off("mousedown.kinetic"),this.off("touchstart.kinetic"))},c.Factory.addGetterSetter(c.Node,"dragBoundFunc"),c.Factory.addGetter(c.Node,"draggable",!1),c.Factory.addOverloadedGetterSetter(c.Node,"draggable");var b=document.documentElement;b.addEventListener("mouseup",c.DD._endDragBefore,!0),b.addEventListener("touchend",c.DD._endDragBefore,!0),b.addEventListener("mouseup",c.DD._endDragAfter,!1),b.addEventListener("touchend",c.DD._endDragAfter,!1)}(),function(){c.Util.addMethods(c.Container,{__init:function(a){this.children=new c.Collection,c.Node.call(this,a)},getChildren:function(){return this.children},hasChildren:function(){return this.getChildren().length>0},removeChildren:function(){for(var a,b=this.children;b.length>0;)a=b[0],a.hasChildren()&&a.removeChildren(),a.remove();return this},destroyChildren:function(){for(var a=this.children;a.length>0;)a[0].destroy();return this},add:function(a){var b=this.children;return this._validateAdd(a),a.index=b.length,a.parent=this,b.push(a),this._fire("add",{child:a}),this},destroy:function(){this.hasChildren()&&this.destroyChildren(),c.Node.prototype.destroy.call(this)},find:function(a){var b,d,e,f,g,h,i,j=[],k=a.replace(/ /g,"").split(","),l=k.length;for(b=0;l>b;b++)if(e=k[b],"#"===e.charAt(0))g=this._getNodeById(e.slice(1)),g&&j.push(g);else if("."===e.charAt(0))f=this._getNodesByName(e.slice(1)),j=j.concat(f);else for(h=this.getChildren(),i=h.length,d=0;i>d;d++)j=j.concat(h[d]._get(e));return c.Collection.toCollection(j)},_getNodeById:function(a){var b=c.ids[a];return void 0!==b&&this.isAncestorOf(b)?b:null},_getNodesByName:function(a){var b=c.names[a]||[];return this._getDescendants(b)},_get:function(a){for(var b=c.Node.prototype._get.call(this,a),d=this.getChildren(),e=d.length,f=0;e>f;f++)b=b.concat(d[f]._get(a));return b},toObject:function(){var a=c.Node.prototype.toObject.call(this);a.children=[];for(var b=this.getChildren(),d=b.length,e=0;d>e;e++){var f=b[e];a.children.push(f.toObject())}return a},_getDescendants:function(a){for(var b=[],c=a.length,d=0;c>d;d++){var e=a[d];this.isAncestorOf(e)&&b.push(e)}return b},isAncestorOf:function(a){for(var b=a.getParent();b;){if(b._id===this._id)return!0;b=b.getParent()}return!1},clone:function(a){var b=c.Node.prototype.clone.call(this,a);return this.getChildren().each(function(a){b.add(a.clone())}),b},getAllIntersections:function(a){var b=[];return this.find("Shape").each(function(c){c.isVisible()&&c.intersects(a)&&b.push(c)}),b},_setChildrenIndices:function(){this.children.each(function(a,b){a.index=b})},drawScene:function(a){var b=this.getLayer(),c=a||b&&b.getCanvas(),d=c&&c.getContext(),e=this._cache.canvas,f=e&&e.scene;return this.isVisible()&&(f?this._drawCachedSceneCanvas(d):this._drawChildren(c,"drawScene")),this},drawHit:function(a){var b=this.getLayer(),c=a||b&&b.hitCanvas,d=c&&c.getContext(),e=this._cache.canvas,f=e&&e.hit;return this.shouldDrawHit()&&(f?this._drawCachedHitCanvas(d):this._drawChildren(c,"drawHit")),this},_drawChildren:function(a,b){var c,d,e=a&&a.getContext(),f=this.getClipWidth(),g=this.getClipHeight(),h=f&&g;h&&(c=this.getClipX(),d=this.getClipY(),e.save(),e._applyTransform(this),e.beginPath(),e.rect(c,d,f,g),e.clip(),e.reset()),this.children.each(function(c){c[b](a)}),h&&e.restore()}}),c.Util.extend(c.Container,c.Node),c.Container.prototype.get=c.Container.prototype.find,c.Factory.addComponentsGetterSetter(c.Container,"clip",["x","y","width","height"]),c.Factory.addGetterSetter(c.Container,"clipX"),c.Factory.addGetterSetter(c.Container,"clipY"),c.Factory.addGetterSetter(c.Container,"clipWidth"),c.Factory.addGetterSetter(c.Container,"clipHeight")}(),function(){function a(a){a.fill()}function b(a){a.stroke()}function d(a){a.fill()}function e(a){a.stroke()}function f(){this._clearCache(g)}var g="hasShadow";c.Util.addMethods(c.Shape,{__init:function(g){this.nodeType="Shape",this._fillFunc=a,this._strokeFunc=b,this._fillFuncHit=d,this._strokeFuncHit=e;for(var h,i=c.shapes;h=c.Util.getRandomColor(),!h||h in i;);this.colorKey=h,i[h]=this,c.Node.call(this,g),this.on("shadowColorChange.kinetic shadowBlurChange.kinetic shadowOffsetChange.kinetic shadowOpacityChange.kinetic shadowEnabledChanged.kinetic",f)},hasChildren:function(){return!1},getChildren:function(){return[]},getContext:function(){return this.getLayer().getContext()},getCanvas:function(){return this.getLayer().getCanvas()},hasShadow:function(){return this._getCache(g,this._hasShadow)},_hasShadow:function(){return this.getShadowEnabled()&&0!==this.getShadowOpacity()&&!!(this.getShadowColor()||this.getShadowBlur()||this.getShadowOffsetX()||this.getShadowOffsetY())},hasFill:function(){return!!(this.getFill()||this.getFillPatternImage()||this.getFillLinearGradientColorStops()||this.getFillRadialGradientColorStops())},hasStroke:function(){return!!(this.stroke()||this.strokeRed()||this.strokeGreen()||this.strokeBlue())},_get:function(a){return this.className===a||this.nodeType===a?[this]:[]},intersects:function(a){var b,c=this.getStage(),d=c.bufferHitCanvas;return d.getContext().clear(),this.drawScene(d),b=d.context.getImageData(0|a.x,0|a.y,1,1).data,b[3]>0},destroy:function(){c.Node.prototype.destroy.call(this),delete c.shapes[this.colorKey]},_useBufferCanvas:function(){return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasFill()&&this.hasStroke()},drawScene:function(a){var b,c,d,e=a||this.getLayer().getCanvas(),f=e.getContext(),g=this._cache.canvas,h=this.sceneFunc(),i=this.hasShadow();return this.isVisible()&&(g?this._drawCachedSceneCanvas(f):h&&(f.save(),this._useBufferCanvas()?(b=this.getStage(),c=b.bufferCanvas,d=c.getContext(),d.clear(),d.save(),d._applyLineJoin(this),d._applyTransform(this),h.call(this,d),d.restore(),i&&(f.save(),f._applyShadow(this),f.drawImage(c._canvas,0,0),f.restore()),f._applyOpacity(this),f.drawImage(c._canvas,0,0)):(f._applyLineJoin(this),f._applyTransform(this),i&&(f.save(),f._applyShadow(this),h.call(this,f),f.restore()),f._applyOpacity(this),h.call(this,f)),f.restore())),this},drawHit:function(a){var b=a||this.getLayer().hitCanvas,c=b.getContext(),d=this.hitFunc()||this.sceneFunc(),e=this._cache.canvas,f=e&&e.hit;return this.shouldDrawHit()&&(f?this._drawCachedHitCanvas(c):d&&(c.save(),c._applyLineJoin(this),c._applyTransform(this),d.call(this,c),c.restore())),this},drawHitFromCache:function(a){var b,d,e,f,g,h,i,j,k=a||0,l=this._cache.canvas,m=this._getCachedSceneCanvas(),n=m.getContext(),o=l.hit,p=o.getContext(),q=m.getWidth(),r=m.getHeight();p.clear();try{for(b=n.getImageData(0,0,q,r),d=b.data,e=p.getImageData(0,0,q,r),f=e.data,g=d.length,h=c.Util._hexToRgb(this.colorKey),i=0;g>i;i+=4)j=d[i+3],j>k&&(f[i]=h.r,f[i+1]=h.g,f[i+2]=h.b,f[i+3]=255);p.putImageData(e,0,0)}catch(s){c.Util.warn("Unable to draw hit graph from cached scene canvas. "+s.message)}return this}}),c.Util.extend(c.Shape,c.Node),c.Factory.addGetterSetter(c.Shape,"stroke"),c.Factory.addGetterSetter(c.Shape,"strokeRed",0,function(a){return a>255?255:0>a?0:Math.round(a)}),c.Factory.addGetterSetter(c.Shape,"strokeGreen",0,function(a){return a>255?255:0>a?0:Math.round(a)}),c.Factory.addGetterSetter(c.Shape,"strokeBlue",0,function(a){return a>255?255:0>a?0:Math.round(a)}),c.Factory.addGetterSetter(c.Shape,"strokeWidth",2),c.Factory.addGetterSetter(c.Shape,"lineJoin"),c.Factory.addGetterSetter(c.Shape,"lineCap"),c.Factory.addGetterSetter(c.Shape,"sceneFunc"),c.Factory.addGetterSetter(c.Shape,"hitFunc"),c.Factory.addGetterSetter(c.Shape,"dash"),c.Factory.addGetterSetter(c.Shape,"shadowColor"),c.Factory.addGetterSetter(c.Shape,"shadowRed",0,function(a){return a>255?255:0>a?0:Math.round(a)}),c.Factory.addGetterSetter(c.Shape,"shadowGreen",0,function(a){return a>255?255:0>a?0:Math.round(a)}),c.Factory.addGetterSetter(c.Shape,"shadowBlue",0,function(a){return a>255?255:0>a?0:Math.round(a)}),c.Factory.addGetterSetter(c.Shape,"shadowBlur"),c.Factory.addGetterSetter(c.Shape,"shadowOpacity"),c.Factory.addComponentsGetterSetter(c.Shape,"shadowOffset",["x","y"]),c.Factory.addGetterSetter(c.Shape,"shadowOffsetX",0),c.Factory.addGetterSetter(c.Shape,"shadowOffsetY",0),c.Factory.addGetterSetter(c.Shape,"fillPatternImage"),c.Factory.addGetterSetter(c.Shape,"fill"),c.Factory.addGetterSetter(c.Shape,"fillRed",0,function(a){return a>255?255:0>a?0:Math.round(a)
}),c.Factory.addGetterSetter(c.Shape,"fillGreen",0,function(a){return a>255?255:0>a?0:Math.round(a)}),c.Factory.addGetterSetter(c.Shape,"fillBlue",0,function(a){return a>255?255:0>a?0:Math.round(a)}),c.Factory.addGetterSetter(c.Shape,"fillPatternX",0),c.Factory.addGetterSetter(c.Shape,"fillPatternY",0),c.Factory.addGetterSetter(c.Shape,"fillLinearGradientColorStops"),c.Factory.addGetterSetter(c.Shape,"fillRadialGradientStartRadius",0),c.Factory.addGetterSetter(c.Shape,"fillRadialGradientEndRadius",0),c.Factory.addGetterSetter(c.Shape,"fillRadialGradientColorStops"),c.Factory.addGetterSetter(c.Shape,"fillPatternRepeat","repeat"),c.Factory.addGetterSetter(c.Shape,"fillEnabled",!0),c.Factory.addGetterSetter(c.Shape,"strokeEnabled",!0),c.Factory.addGetterSetter(c.Shape,"shadowEnabled",!0),c.Factory.addGetterSetter(c.Shape,"dashEnabled",!0),c.Factory.addGetterSetter(c.Shape,"strokeScaleEnabled",!0),c.Factory.addGetterSetter(c.Shape,"fillPriority","color"),c.Factory.addComponentsGetterSetter(c.Shape,"fillPatternOffset",["x","y"]),c.Factory.addGetterSetter(c.Shape,"fillPatternOffsetX",0),c.Factory.addGetterSetter(c.Shape,"fillPatternOffsetY",0),c.Factory.addComponentsGetterSetter(c.Shape,"fillPatternScale",["x","y"]),c.Factory.addGetterSetter(c.Shape,"fillPatternScaleX",0),c.Factory.addGetterSetter(c.Shape,"fillPatternScaleY",0),c.Factory.addComponentsGetterSetter(c.Shape,"fillLinearGradientStartPoint",["x","y"]),c.Factory.addGetterSetter(c.Shape,"fillLinearGradientStartPointX",0),c.Factory.addGetterSetter(c.Shape,"fillLinearGradientStartPointY",0),c.Factory.addComponentsGetterSetter(c.Shape,"fillLinearGradientEndPoint",["x","y"]),c.Factory.addGetterSetter(c.Shape,"fillLinearGradientEndPointX",0),c.Factory.addGetterSetter(c.Shape,"fillLinearGradientEndPointY",0),c.Factory.addComponentsGetterSetter(c.Shape,"fillRadialGradientStartPoint",["x","y"]),c.Factory.addGetterSetter(c.Shape,"fillRadialGradientStartPointX",0),c.Factory.addGetterSetter(c.Shape,"fillRadialGradientStartPointY",0),c.Factory.addComponentsGetterSetter(c.Shape,"fillRadialGradientEndPoint",["x","y"]),c.Factory.addGetterSetter(c.Shape,"fillRadialGradientEndPointX",0),c.Factory.addGetterSetter(c.Shape,"fillRadialGradientEndPointY",0),c.Factory.addGetterSetter(c.Shape,"fillPatternRotation",0),c.Factory.backCompat(c.Shape,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"})}(),function(){function b(a,b){a.content.addEventListener(b,function(c){a[K+b](c)},!1)}var d="Stage",e="string",f="px",g="mouseout",h="mouseleave",i="mouseover",j="mouseenter",k="mousemove",l="mousedown",m="mouseup",n="click",o="dblclick",p="touchstart",q="touchend",r="tap",s="dbltap",t="touchmove",u="contentMouseout",v="contentMouseover",w="contentMousemove",x="contentMousedown",y="contentMouseup",z="contentClick",A="contentDblclick",B="contentTouchstart",C="contentTouchend",D="contentDbltap",E="contentTouchmove",F="div",G="relative",H="inline-block",I="kineticjs-content",J=" ",K="_",L="container",M="",N=[l,k,m,g,p,t,q,i],O=N.length;c.Util.addMethods(c.Stage,{___init:function(a){this.nodeType=d,c.Container.call(this,a),this._id=c.idCounter++,this._buildDOM(),this._bindContentEvents(),this._enableNestedTransforms=!1,c.stages.push(this)},_validateAdd:function(a){"Layer"!==a.getType()&&c.Util.error("You may only add layers to the stage.")},setContainer:function(a){return typeof a===e&&(a=document.getElementById(a)),this._setAttr(L,a),this},shouldDrawHit:function(){return!0},draw:function(){return c.Node.prototype.draw.call(this),this},setHeight:function(a){return c.Node.prototype.setHeight.call(this,a),this._resizeDOM(),this},setWidth:function(a){return c.Node.prototype.setWidth.call(this,a),this._resizeDOM(),this},clear:function(){var a,b=this.children,c=b.length;for(a=0;c>a;a++)b[a].clear();return this},destroy:function(){var a=this.content;c.Container.prototype.destroy.call(this),a&&c.Util._isInDocument(a)&&this.getContainer().removeChild(a)},getPointerPosition:function(){return this.pointerPos},getStage:function(){return this},getContent:function(){return this.content},toDataURL:function(a){function b(c){var f=j[c],g=f.toDataURL(),k=new Image;k.onload=function(){i.drawImage(k,0,0),c<j.length-1?b(c+1):a.callback(h.toDataURL(d,e))},k.src=g}a=a||{};var d=a.mimeType||null,e=a.quality||null,f=a.x||0,g=a.y||0,h=new c.SceneCanvas({width:a.width||this.getWidth(),height:a.height||this.getHeight(),pixelRatio:1}),i=h.getContext()._context,j=this.children;(f||g)&&i.translate(-1*f,-1*g),b(0)},toImage:function(a){var b=a.callback;a.callback=function(a){c.Util._getImage(a,function(a){b(a)})},this.toDataURL(a)},getIntersection:function(a){var b,c,d=this.getChildren(),e=d.length,f=e-1;for(b=f;b>=0;b--)if(c=d[b].getIntersection(a))return c;return null},_resizeDOM:function(){if(this.content){var a,b,c=this.getWidth(),d=this.getHeight(),e=this.getChildren(),g=e.length;for(this.content.style.width=c+f,this.content.style.height=d+f,this.bufferCanvas.setSize(c,d),this.bufferHitCanvas.setSize(c,d),a=0;g>a;a++)b=e[a],b.getCanvas().setSize(c,d),b.hitCanvas.setSize(c,d),b.draw()}},add:function(a){return c.Container.prototype.add.call(this,a),a.canvas.setSize(this.attrs.width,this.attrs.height),a.hitCanvas.setSize(this.attrs.width,this.attrs.height),a.draw(),this.content.appendChild(a.canvas._canvas),this},getParent:function(){return null},getLayer:function(){return null},getLayers:function(){return this.getChildren()},_bindContentEvents:function(){var a;for(a=0;O>a;a++)b(this,N[a])},_mouseover:function(a){this._fire(v,a)},_mouseout:function(a){this._setPointerPosition(a);var b=this.targetShape;b&&!c.isDragging()&&(b._fireAndBubble(g,a),b._fireAndBubble(h,a),this.targetShape=null),this.pointerPos=void 0,this._fire(u,a)},_mousemove:function(a){this._setPointerPosition(a);var b=c.DD,d=this.getIntersection(this.getPointerPosition());d&&d.isListening()?c.isDragging()||this.targetShape&&this.targetShape._id===d._id?d._fireAndBubble(k,a):(this.targetShape&&(this.targetShape._fireAndBubble(g,a,d),this.targetShape._fireAndBubble(h,a,d)),d._fireAndBubble(i,a,this.targetShape),d._fireAndBubble(j,a,this.targetShape),this.targetShape=d):this.targetShape&&!c.isDragging()&&(this.targetShape._fireAndBubble(g,a),this.targetShape._fireAndBubble(h,a),this.targetShape=null),this._fire(w,a),b&&b._drag(a),a.preventDefault&&a.preventDefault()},_mousedown:function(a){this._setPointerPosition(a);var b=this.getIntersection(this.getPointerPosition());c.listenClickTap=!0,b&&b.isListening()&&(this.clickStartShape=b,b._fireAndBubble(l,a)),this._fire(x,a),a.preventDefault&&a.preventDefault()},_mouseup:function(a){this._setPointerPosition(a);var b=this.getIntersection(this.getPointerPosition()),d=this.clickStartShape,e=!1;c.inDblClickWindow?(e=!0,c.inDblClickWindow=!1):c.inDblClickWindow=!0,setTimeout(function(){c.inDblClickWindow=!1},c.dblClickWindow),b&&b.isListening()&&(b._fireAndBubble(m,a),c.listenClickTap&&d&&d._id===b._id&&(b._fireAndBubble(n,a),e&&b._fireAndBubble(o,a))),this._fire(y,a),c.listenClickTap&&(this._fire(z,a),e&&this._fire(A,a)),c.listenClickTap=!1,a.preventDefault&&a.preventDefault()},_touchstart:function(a){this._setPointerPosition(a);var b=this.getIntersection(this.getPointerPosition());c.listenClickTap=!0,b&&b.isListening()&&(this.tapStartShape=b,b._fireAndBubble(p,a),b.isListening()&&a.preventDefault&&a.preventDefault()),this._fire(B,a)},_touchend:function(a){this._setPointerPosition(a);var b=this.getIntersection(this.getPointerPosition());fireDblClick=!1,c.inDblClickWindow?(fireDblClick=!0,c.inDblClickWindow=!1):c.inDblClickWindow=!0,setTimeout(function(){c.inDblClickWindow=!1},c.dblClickWindow),b&&b.isListening()&&(b._fireAndBubble(q,a),c.listenClickTap&&b._id===this.tapStartShape._id&&(b._fireAndBubble(r,a),fireDblClick&&b._fireAndBubble(s,a)),b.isListening()&&a.preventDefault&&a.preventDefault()),c.listenClickTap&&(this._fire(C,a),fireDblClick&&this._fire(D,a)),c.listenClickTap=!1},_touchmove:function(a){this._setPointerPosition(a);var b=c.DD,d=this.getIntersection(this.getPointerPosition());d&&d.isListening()&&(d._fireAndBubble(t,a),d.isListening()&&a.preventDefault&&a.preventDefault()),this._fire(E,a),b&&b._drag(a)},_setPointerPosition:function(b){var d,b=b?b:a.event,e=this._getContentPosition(),f=b.offsetX,g=b.clientX,h=null,i=null;void 0!==b.touches?1===b.touches.length&&(d=b.touches[0],h=d.clientX-e.left,i=d.clientY-e.top):void 0!==f?(h=f,i=b.offsetY):"mozilla"===c.UA.browser?(h=b.layerX,i=b.layerY):void 0!==g&&e&&(h=g-e.left,i=b.clientY-e.top),null!==h&&null!==i&&(this.pointerPos={x:h,y:i})},_getContentPosition:function(){var a=this.content.getBoundingClientRect?this.content.getBoundingClientRect():{top:0,left:0};return{top:a.top,left:a.left}},_buildDOM:function(){var a=this.getContainer();a.innerHTML=M,this.content=document.createElement(F),this.content.style.position=G,this.content.style.display=H,this.content.className=I,this.content.setAttribute("role","presentation"),a.appendChild(this.content),this.bufferCanvas=new c.SceneCanvas({pixelRatio:1}),this.bufferHitCanvas=new c.HitCanvas,this._resizeDOM()},_onContent:function(a,b){var c,d,e=a.split(J),f=e.length;for(c=0;f>c;c++)d=e[c],this.content.addEventListener(d,b,!1)}}),c.Util.extend(c.Stage,c.Container),c.Factory.addGetter(c.Stage,"container"),c.Factory.addOverloadedGetterSetter(c.Stage,"container")}(),function(){var a="#",b="beforeDraw",d="draw",e=[{x:0,y:0},{x:-1,y:0},{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1},{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:-1,y:1}],f=e.length;c.Util.addMethods(c.Layer,{___init:function(a){this.nodeType="Layer",this.canvas=new c.SceneCanvas,this.hitCanvas=new c.HitCanvas,c.Container.call(this,a)},_validateAdd:function(a){var b=a.getType();"Group"!==b&&"Shape"!==b&&c.Util.error("You may only add groups and shapes to a layer.")},getIntersection:function(a){var b,c,d,g;if(!this.isVisible())return null;for(c=0;f>c;c++){if(d=e[c],b=this._getIntersection({x:a.x+d.x,y:a.y+d.y}),g=b.shape)return g;if(!b.antialiased)return null}},_getIntersection:function(b){var d,e,f=this.hitCanvas.context._context.getImageData(b.x,b.y,1,1).data,g=f[3];return 255===g?(d=c.Util._rgbToHex(f[0],f[1],f[2]),e=c.shapes[a+d],{shape:e}):g>0?{antialiased:!0}:{}},drawScene:function(a){var e=this.getLayer(),f=a||e&&e.getCanvas();return this._fire(b,{node:this}),this.getClearBeforeDraw()&&f.getContext().clear(),c.Container.prototype.drawScene.call(this,f),this._fire(d,{node:this}),this},drawHit:function(a){var b=this.getLayer(),d=a||b&&b.hitCanvas;return b&&b.getClearBeforeDraw()&&b.getHitCanvas().getContext().clear(),c.Container.prototype.drawHit.call(this,d),this},getCanvas:function(){return this.canvas},getHitCanvas:function(){return this.hitCanvas},getContext:function(){return this.getCanvas().getContext()},clear:function(a){var b=this.getContext(),c=this.getHitCanvas().getContext();return b.clear(a),c.clear(a),this},setVisible:function(a){return c.Node.prototype.setVisible.call(this,a),a?(this.getCanvas()._canvas.style.display="block",this.hitCanvas._canvas.style.display="block"):(this.getCanvas()._canvas.style.display="none",this.hitCanvas._canvas.style.display="none"),this},setZIndex:function(a){c.Node.prototype.setZIndex.call(this,a);var b=this.getStage();return b&&(b.content.removeChild(this.getCanvas()._canvas),a<b.getChildren().length-1?b.content.insertBefore(this.getCanvas()._canvas,b.getChildren()[a+1].getCanvas()._canvas):b.content.appendChild(this.getCanvas()._canvas)),this},moveToTop:function(){c.Node.prototype.moveToTop.call(this);var a=this.getStage();a&&(a.content.removeChild(this.getCanvas()._canvas),a.content.appendChild(this.getCanvas()._canvas))},moveUp:function(){if(c.Node.prototype.moveUp.call(this)){var a=this.getStage();a&&(a.content.removeChild(this.getCanvas()._canvas),this.index<a.getChildren().length-1?a.content.insertBefore(this.getCanvas()._canvas,a.getChildren()[this.index+1].getCanvas()._canvas):a.content.appendChild(this.getCanvas()._canvas))}},moveDown:function(){if(c.Node.prototype.moveDown.call(this)){var a=this.getStage();if(a){var b=a.getChildren();a.content.removeChild(this.getCanvas()._canvas),a.content.insertBefore(this.getCanvas()._canvas,b[this.index+1].getCanvas()._canvas)}}},moveToBottom:function(){if(c.Node.prototype.moveToBottom.call(this)){var a=this.getStage();if(a){var b=a.getChildren();a.content.removeChild(this.getCanvas()._canvas),a.content.insertBefore(this.getCanvas()._canvas,b[1].getCanvas()._canvas)}}},getLayer:function(){return this},remove:function(){var a=this.getStage(),b=this.getCanvas(),d=b._canvas;return c.Node.prototype.remove.call(this),a&&d&&c.Util._isInDocument(d)&&a.content.removeChild(d),this},getStage:function(){return this.parent},enableHitGraph:function(){return this.setHitGraphEnabled(!0),this},disableHitGraph:function(){return this.setHitGraphEnabled(!1),this}}),c.Util.extend(c.Layer,c.Container),c.Factory.addGetterSetter(c.Layer,"clearBeforeDraw",!0),c.Factory.addGetterSetter(c.Layer,"hitGraphEnabled",!0),c.Layer.prototype.isHitGraphEnabled=c.Layer.prototype.getHitGraphEnabled}(),function(){c.Util.addMethods(c.Group,{___init:function(a){this.nodeType="Group",c.Container.call(this,a)},_validateAdd:function(a){var b=a.getType();"Group"!==b&&"Shape"!==b&&c.Util.error("You may only add groups and shapes to groups.")}}),c.Util.extend(c.Group,c.Container)}(),function(){c.Rect=function(a){this.___init(a)},c.Rect.prototype={___init:function(a){c.Shape.call(this,a),this.className="Rect",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){var b=this.getCornerRadius(),c=this.getWidth(),d=this.getHeight();a.beginPath(),b?(a.moveTo(b,0),a.lineTo(c-b,0),a.arc(c-b,b,b,3*Math.PI/2,0,!1),a.lineTo(c,d-b),a.arc(c-b,d-b,b,0,Math.PI/2,!1),a.lineTo(b,d),a.arc(b,d-b,b,Math.PI/2,Math.PI,!1),a.lineTo(0,b),a.arc(b,b,b,Math.PI,3*Math.PI/2,!1)):a.rect(0,0,c,d),a.closePath(),a.fillStrokeShape(this)}},c.Util.extend(c.Rect,c.Shape),c.Factory.addGetterSetter(c.Rect,"cornerRadius",0)}(),function(){var a=2*Math.PI-1e-4,b="Circle";c.Circle=function(a){this.___init(a)},c.Circle.prototype={___init:function(a){c.Shape.call(this,a),this.className=b,this.sceneFunc(this._sceneFunc)},_sceneFunc:function(b){b.beginPath(),b.arc(0,0,this.getRadius(),0,a,!1),b.closePath(),b.fillStrokeShape(this)},getWidth:function(){return 2*this.getRadius()},getHeight:function(){return 2*this.getRadius()},setWidth:function(a){c.Node.prototype.setWidth.call(this,a),this.setRadius(a/2)},setHeight:function(a){c.Node.prototype.setHeight.call(this,a),this.setRadius(a/2)}},c.Util.extend(c.Circle,c.Shape),c.Factory.addGetterSetter(c.Circle,"radius",0)}(),function(){var a=2*Math.PI-1e-4,b="Ellipse";c.Ellipse=function(a){this.___init(a)},c.Ellipse.prototype={___init:function(a){c.Shape.call(this,a),this.className=b,this.sceneFunc(this._sceneFunc)},_sceneFunc:function(b){var c=this.getRadius(),d=c.x,e=c.y;b.beginPath(),b.save(),d!==e&&b.scale(1,e/d),b.arc(0,0,d,0,a,!1),b.restore(),b.closePath(),b.fillStrokeShape(this)},getWidth:function(){return 2*this.getRadius().x},getHeight:function(){return 2*this.getRadius().y},setWidth:function(a){c.Node.prototype.setWidth.call(this,a),this.setRadius({x:a/2})},setHeight:function(a){c.Node.prototype.setHeight.call(this,a),this.setRadius({y:a/2})}},c.Util.extend(c.Ellipse,c.Shape),c.Factory.addComponentsGetterSetter(c.Ellipse,"radius",["x","y"]),c.Factory.addGetterSetter(c.Ellipse,"radiusX",0),c.Factory.addGetterSetter(c.Ellipse,"radiusY",0)}(),function(){var a=2*Math.PI-1e-4;c.Ring=function(a){this.___init(a)},c.Ring.prototype={___init:function(a){c.Shape.call(this,a),this.className="Ring",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(b){b.beginPath(),b.arc(0,0,this.getInnerRadius(),0,a,!1),b.moveTo(this.getOuterRadius(),0),b.arc(0,0,this.getOuterRadius(),a,0,!0),b.closePath(),b.fillStrokeShape(this)},getWidth:function(){return 2*this.getOuterRadius()},getHeight:function(){return 2*this.getOuterRadius()},setWidth:function(a){c.Node.prototype.setWidth.call(this,a),this.setOuterRadius(a/2)},setHeight:function(a){c.Node.prototype.setHeight.call(this,a),this.setOuterRadius(a/2)}},c.Util.extend(c.Ring,c.Shape),c.Factory.addGetterSetter(c.Ring,"innerRadius",function(){return 0}),c.Factory.addGetterSetter(c.Ring,"outerRadius",function(){return 0})}(),function(){c.Wedge=function(a){this.___init(a)},c.Wedge.prototype={___init:function(a){c.Shape.call(this,a),this.className="Wedge",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){a.beginPath(),a.arc(0,0,this.getRadius(),0,this.getAngle()*Math.PI/180,this.getClockwise()),a.lineTo(0,0),a.closePath(),a.fillStrokeShape(this)}},c.Util.extend(c.Wedge,c.Shape),c.Factory.addGetterSetter(c.Wedge,"radius",0),c.Factory.addGetterSetter(c.Wedge,"angle",0),c.Factory.addGetterSetter(c.Wedge,"clockwise",!1),c.Factory.backCompat(c.Wedge,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"})}(),function(){c.Arc=function(a){this.___init(a)},c.Arc.prototype={___init:function(a){c.Shape.call(this,a),this.className="Arc",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){var b=this.angle()*Math.PI/180,c=this.clockwise();a.beginPath(),a.arc(0,0,this.getOuterRadius(),0,b,c),a.arc(0,0,this.getInnerRadius(),b,0,!c),a.closePath(),a.fillStrokeShape(this)}},c.Util.extend(c.Arc,c.Shape),c.Factory.addGetterSetter(c.Arc,"innerRadius",0),c.Factory.addGetterSetter(c.Arc,"outerRadius",0),c.Factory.addGetterSetter(c.Arc,"angle",0),c.Factory.addGetterSetter(c.Arc,"clockwise",!1)}(),function(){var a="Image";c.Image=function(a){this.___init(a)},c.Image.prototype={___init:function(b){c.Shape.call(this,b),this.className=a,this.sceneFunc(this._sceneFunc),this.hitFunc(this._hitFunc)},_useBufferCanvas:function(){return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasStroke()},_sceneFunc:function(a){var b,c,d,e,f=this.getWidth(),g=this.getHeight(),h=this.getImage();h&&(b=this.getCrop(),c=b.width,d=b.height,e=c&&d?[h,b.x,b.y,c,d,0,0,f,g]:[h,0,0,f,g]),a.beginPath(),a.rect(0,0,f,g),a.closePath(),a.fillStrokeShape(this),h&&a.drawImage.apply(a,e)},_hitFunc:function(a){var b=this.getWidth(),c=this.getHeight();a.beginPath(),a.rect(0,0,b,c),a.closePath(),a.fillStrokeShape(this)},getWidth:function(){var a=this.getImage();return this.attrs.width||(a?a.width:0)},getHeight:function(){var a=this.getImage();return this.attrs.height||(a?a.height:0)}},c.Util.extend(c.Image,c.Shape),c.Factory.addGetterSetter(c.Image,"image"),c.Factory.addComponentsGetterSetter(c.Image,"crop",["x","y","width","height"]),c.Factory.addGetterSetter(c.Image,"cropX",0),c.Factory.addGetterSetter(c.Image,"cropY",0),c.Factory.addGetterSetter(c.Image,"cropWidth",0),c.Factory.addGetterSetter(c.Image,"cropHeight",0)}(),function(){function a(a){a.fillText(this.partialText,0,0)}function b(a){a.strokeText(this.partialText,0,0)}var d="auto",e="canvas",f="center",g="Change.kinetic",h="2d",i="-",j="",k="left",l="text",m="Text",n="middle",o="normal",p="px ",q=" ",r="right",s="word",t="char",u="none",v=["fontFamily","fontSize","fontStyle","padding","align","lineHeight","text","width","height","wrap"],w=v.length,x=document.createElement(e).getContext(h);c.Text=function(a){this.___init(a)},c.Text.prototype={___init:function(e){var f=this;void 0===e.width&&(e.width=d),void 0===e.height&&(e.height=d),c.Shape.call(this,e),this._fillFunc=a,this._strokeFunc=b,this.className=m;for(var h=0;w>h;h++)this.on(v[h]+g,f._setTextData);this._setTextData(),this.sceneFunc(this._sceneFunc),this.hitFunc(this._hitFunc)},_sceneFunc:function(a){var b,c=this.getPadding(),d=this.getTextHeight(),e=this.getLineHeight()*d,g=this.textArr,h=g.length,i=this.getWidth();for(a.setAttr("font",this._getContextFont()),a.setAttr("textBaseline",n),a.setAttr("textAlign",k),a.save(),a.translate(c,0),a.translate(0,c+d/2),b=0;h>b;b++){var j=g[b],l=j.text,m=j.width;a.save(),this.getAlign()===r?a.translate(i-m-2*c,0):this.getAlign()===f&&a.translate((i-m-2*c)/2,0),this.partialText=l,a.fillStrokeShape(this),a.restore(),a.translate(0,e)}a.restore()},_hitFunc:function(a){var b=this.getWidth(),c=this.getHeight();a.beginPath(),a.rect(0,0,b,c),a.closePath(),a.fillStrokeShape(this)},setText:function(a){var b=c.Util._isString(a)?a:a.toString();return this._setAttr(l,b),this},getWidth:function(){return this.attrs.width===d?this.getTextWidth()+2*this.getPadding():this.attrs.width},getHeight:function(){return this.attrs.height===d?this.getTextHeight()*this.textArr.length*this.getLineHeight()+2*this.getPadding():this.attrs.height},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},_getTextSize:function(a){var b,c=x,d=this.getFontSize();return c.save(),c.font=this._getContextFont(),b=c.measureText(a),c.restore(),{width:b.width,height:parseInt(d,10)}},_getContextFont:function(){return this.getFontStyle()+q+this.getFontSize()+p+this.getFontFamily()},_addTextLine:function(a,b){return this.textArr.push({text:a,width:b})},_getTextWidth:function(a){return x.measureText(a).width},_setTextData:function(){var a=this.getText().split("\n"),b=+this.getFontSize(),c=0,e=this.getLineHeight()*b,f=this.attrs.width,g=this.attrs.height,h=f!==d,j=g!==d,k=this.getPadding(),l=f-2*k,m=g-2*k,n=0,o=this.getWrap(),r=o!==u,s=o!==t&&r;this.textArr=[],x.save(),x.font=this.getFontStyle()+q+b+p+this.getFontFamily();for(var v=0,w=a.length;w>v;++v){var y=a[v],z=this._getTextWidth(y);if(h&&z>l)for(;y.length>0;){for(var A=0,B=y.length,C="",D=0;B>A;){var E=A+B>>>1,F=y.slice(0,E+1),G=this._getTextWidth(F);l>=G?(A=E+1,C=F,D=G):B=E}if(!C)break;if(s){var H=Math.max(C.lastIndexOf(q),C.lastIndexOf(i))+1;H>0&&(A=H,C=C.slice(0,A),D=this._getTextWidth(C))}if(this._addTextLine(C,D),n+=e,!r||j&&n+e>m)break;if(y=y.slice(A),y.length>0&&(z=this._getTextWidth(y),l>=z)){this._addTextLine(y,z),n+=e;break}}else this._addTextLine(y,z),n+=e,c=Math.max(c,z);if(j&&n+e>m)break}x.restore(),this.textHeight=b,this.textWidth=c}},c.Util.extend(c.Text,c.Shape),c.Factory.addGetterSetter(c.Text,"fontFamily","Arial"),c.Factory.addGetterSetter(c.Text,"fontSize",12),c.Factory.addGetterSetter(c.Text,"fontStyle",o),c.Factory.addGetterSetter(c.Text,"padding",0),c.Factory.addGetterSetter(c.Text,"align",k),c.Factory.addGetterSetter(c.Text,"lineHeight",1),c.Factory.addGetterSetter(c.Text,"wrap",s),c.Factory.addGetter(c.Text,"text",j),c.Factory.addOverloadedGetterSetter(c.Text,"text")}(),function(){c.Line=function(a){this.___init(a)},c.Line.prototype={___init:function(a){c.Shape.call(this,a),this.className="Line",this.on("pointsChange.kinetic tensionChange.kinetic closedChange.kinetic",function(){this._clearCache("tensionPoints")}),this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){var b,c,d,e=this.getPoints(),f=e.length,g=this.getTension(),h=this.getClosed();if(a.beginPath(),a.moveTo(e[0],e[1]),0!==g&&f>4){for(b=this.getTensionPoints(),c=b.length,d=h?0:4,h||a.quadraticCurveTo(b[0],b[1],b[2],b[3]);c-2>d;)a.bezierCurveTo(b[d++],b[d++],b[d++],b[d++],b[d++],b[d++]);h||a.quadraticCurveTo(b[c-2],b[c-1],e[f-2],e[f-1])}else for(d=2;f>d;d+=2)a.lineTo(e[d],e[d+1]);h?(a.closePath(),a.fillStrokeShape(this)):a.strokeShape(this)},getTensionPoints:function(){return this._getCache("tensionPoints",this._getTensionPoints)},_getTensionPoints:function(){return this.getClosed()?this._getTensionPointsClosed():c.Util._expandPoints(this.getPoints(),this.getTension())},_getTensionPointsClosed:function(){var a=this.getPoints(),b=a.length,d=this.getTension(),e=c.Util,f=e._getControlPoints(a[b-2],a[b-1],a[0],a[1],a[2],a[3],d),g=e._getControlPoints(a[b-4],a[b-3],a[b-2],a[b-1],a[0],a[1],d),h=c.Util._expandPoints(a,d),i=[f[2],f[3]].concat(h).concat([g[0],g[1],a[b-2],a[b-1],g[2],g[3],f[0],f[1],a[0],a[1]]);return i}},c.Util.extend(c.Line,c.Shape),c.Factory.addGetterSetter(c.Line,"closed",!1),c.Factory.addGetterSetter(c.Line,"tension",0),c.Factory.addGetterSetter(c.Line,"points")}(),function(){c.Sprite=function(a){this.___init(a)},c.Sprite.prototype={___init:function(a){c.Shape.call(this,a),this.className="Sprite",this.anim=new c.Animation,this.on("animationChange.kinetic",function(){this.frameIndex(0)}),this.sceneFunc(this._sceneFunc),this.hitFunc(this._hitFunc)},_sceneFunc:function(a){var b=this.getAnimation(),c=this.frameIndex(),d=4*c,e=this.getAnimations()[b],f=e[d+0],g=e[d+1],h=e[d+2],i=e[d+3],j=this.getImage();j&&a.drawImage(j,f,g,h,i,0,0,h,i)},_hitFunc:function(a){var b=this.getAnimation(),c=this.frameIndex(),d=4*c,e=this.getAnimations()[b],f=e[d+2],g=e[d+3];a.beginPath(),a.rect(0,0,f,g),a.closePath(),a.fillShape(this)},_useBufferCanvas:function(){return(this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasStroke()},start:function(){var a=this,b=this.getLayer();this.anim.setLayers(b),this.interval=setInterval(function(){a._updateIndex()},1e3/this.getFrameRate()),this.anim.start()},stop:function(){this.anim.stop(),clearInterval(this.interval)},_updateIndex:function(){var a=this.frameIndex(),b=this.getAnimation(),c=this.getAnimations(),d=c[b],e=d.length/4;e-1>a?this.frameIndex(a+1):this.frameIndex(0)}},c.Util.extend(c.Sprite,c.Shape),c.Factory.addGetterSetter(c.Sprite,"animation"),c.Factory.addGetterSetter(c.Sprite,"animations"),c.Factory.addGetterSetter(c.Sprite,"image"),c.Factory.addGetterSetter(c.Sprite,"frameIndex",0),c.Factory.addGetterSetter(c.Sprite,"frameRate",17),c.Factory.backCompat(c.Sprite,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"})}(),function(){c.Path=function(a){this.___init(a)},c.Path.prototype={___init:function(a){this.dataArray=[];var b=this;c.Shape.call(this,a),this.className="Path",this.dataArray=c.Path.parsePathData(this.getData()),this.on("dataChange.kinetic",function(){b.dataArray=c.Path.parsePathData(this.getData())}),this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){var b=this.dataArray,c=!1;a.beginPath();for(var d=0;d<b.length;d++){var e=b[d].command,f=b[d].points;switch(e){case"L":a.lineTo(f[0],f[1]);break;case"M":a.moveTo(f[0],f[1]);break;case"C":a.bezierCurveTo(f[0],f[1],f[2],f[3],f[4],f[5]);break;case"Q":a.quadraticCurveTo(f[0],f[1],f[2],f[3]);break;case"A":var g=f[0],h=f[1],i=f[2],j=f[3],k=f[4],l=f[5],m=f[6],n=f[7],o=i>j?i:j,p=i>j?1:i/j,q=i>j?j/i:1;a.translate(g,h),a.rotate(m),a.scale(p,q),a.arc(0,0,o,k,k+l,1-n),a.scale(1/p,1/q),a.rotate(-m),a.translate(-g,-h);break;case"z":a.closePath(),c=!0}}c?a.fillStrokeShape(this):a.strokeShape(this)}},c.Util.extend(c.Path,c.Shape),c.Path.getLineLength=function(a,b,c,d){return Math.sqrt((c-a)*(c-a)+(d-b)*(d-b))},c.Path.getPointOnLine=function(a,b,c,d,e,f,g){void 0===f&&(f=b),void 0===g&&(g=c);var h=(e-c)/(d-b+1e-8),i=Math.sqrt(a*a/(1+h*h));b>d&&(i*=-1);var j,k=h*i;if(d===b)j={x:f,y:g+k};else if((g-c)/(f-b+1e-8)===h)j={x:f+i,y:g+k};else{var l,m,n=this.getLineLength(b,c,d,e);if(1e-8>n)return void 0;var o=(f-b)*(d-b)+(g-c)*(e-c);o/=n*n,l=b+o*(d-b),m=c+o*(e-c);var p=this.getLineLength(f,g,l,m),q=Math.sqrt(a*a-p*p);i=Math.sqrt(q*q/(1+h*h)),b>d&&(i*=-1),k=h*i,j={x:l+i,y:m+k}}return j},c.Path.getPointOnCubicBezier=function(a,b,c,d,e,f,g,h,i){function j(a){return a*a*a}function k(a){return 3*a*a*(1-a)}function l(a){return 3*a*(1-a)*(1-a)}function m(a){return(1-a)*(1-a)*(1-a)}var n=h*j(a)+f*k(a)+d*l(a)+b*m(a),o=i*j(a)+g*k(a)+e*l(a)+c*m(a);return{x:n,y:o}},c.Path.getPointOnQuadraticBezier=function(a,b,c,d,e,f,g){function h(a){return a*a}function i(a){return 2*a*(1-a)}function j(a){return(1-a)*(1-a)}var k=f*h(a)+d*i(a)+b*j(a),l=g*h(a)+e*i(a)+c*j(a);return{x:k,y:l}},c.Path.getPointOnEllipticalArc=function(a,b,c,d,e,f){var g=Math.cos(f),h=Math.sin(f),i={x:c*Math.cos(e),y:d*Math.sin(e)};return{x:a+(i.x*g-i.y*h),y:b+(i.x*h+i.y*g)}},c.Path.parsePathData=function(a){if(!a)return[];var b=a,c=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];b=b.replace(new RegExp(" ","g"),",");for(var d=0;d<c.length;d++)b=b.replace(new RegExp(c[d],"g"),"|"+c[d]);var e=b.split("|"),f=[],g=0,h=0;for(d=1;d<e.length;d++){var i=e[d],j=i.charAt(0);i=i.slice(1),i=i.replace(new RegExp(",-","g"),"-"),i=i.replace(new RegExp("-","g"),",-"),i=i.replace(new RegExp("e,-","g"),"e-");var k=i.split(",");k.length>0&&""===k[0]&&k.shift();for(var l=0;l<k.length;l++)k[l]=parseFloat(k[l]);for(;k.length>0&&!isNaN(k[0]);){var m,n,o,p,q,r,s,t,u,v,w=null,x=[],y=g,z=h;switch(j){case"l":g+=k.shift(),h+=k.shift(),w="L",x.push(g,h);break;case"L":g=k.shift(),h=k.shift(),x.push(g,h);break;case"m":var A=k.shift(),B=k.shift();if(g+=A,h+=B,w="M",f.length>2&&"z"===f[f.length-1].command)for(var C=f.length-2;C>=0;C--)if("M"===f[C].command){g=f[C].points[0]+A,h=f[C].points[1]+B;break}x.push(g,h),j="l";break;case"M":g=k.shift(),h=k.shift(),w="M",x.push(g,h),j="L";break;case"h":g+=k.shift(),w="L",x.push(g,h);break;case"H":g=k.shift(),w="L",x.push(g,h);break;case"v":h+=k.shift(),w="L",x.push(g,h);break;case"V":h=k.shift(),w="L",x.push(g,h);break;case"C":x.push(k.shift(),k.shift(),k.shift(),k.shift()),g=k.shift(),h=k.shift(),x.push(g,h);break;case"c":x.push(g+k.shift(),h+k.shift(),g+k.shift(),h+k.shift()),g+=k.shift(),h+=k.shift(),w="C",x.push(g,h);break;case"S":n=g,o=h,m=f[f.length-1],"C"===m.command&&(n=g+(g-m.points[2]),o=h+(h-m.points[3])),x.push(n,o,k.shift(),k.shift()),g=k.shift(),h=k.shift(),w="C",x.push(g,h);break;case"s":n=g,o=h,m=f[f.length-1],"C"===m.command&&(n=g+(g-m.points[2]),o=h+(h-m.points[3])),x.push(n,o,g+k.shift(),h+k.shift()),g+=k.shift(),h+=k.shift(),w="C",x.push(g,h);break;case"Q":x.push(k.shift(),k.shift()),g=k.shift(),h=k.shift(),x.push(g,h);break;case"q":x.push(g+k.shift(),h+k.shift()),g+=k.shift(),h+=k.shift(),w="Q",x.push(g,h);break;case"T":n=g,o=h,m=f[f.length-1],"Q"===m.command&&(n=g+(g-m.points[0]),o=h+(h-m.points[1])),g=k.shift(),h=k.shift(),w="Q",x.push(n,o,g,h);break;case"t":n=g,o=h,m=f[f.length-1],"Q"===m.command&&(n=g+(g-m.points[0]),o=h+(h-m.points[1])),g+=k.shift(),h+=k.shift(),w="Q",x.push(n,o,g,h);break;case"A":p=k.shift(),q=k.shift(),r=k.shift(),s=k.shift(),t=k.shift(),u=g,v=h,g=k.shift(),h=k.shift(),w="A",x=this.convertEndpointToCenterParameterization(u,v,g,h,s,t,p,q,r);break;case"a":p=k.shift(),q=k.shift(),r=k.shift(),s=k.shift(),t=k.shift(),u=g,v=h,g+=k.shift(),h+=k.shift(),w="A",x=this.convertEndpointToCenterParameterization(u,v,g,h,s,t,p,q,r)}f.push({command:w||j,points:x,start:{x:y,y:z},pathLength:this.calcLength(y,z,w||j,x)})}("z"===j||"Z"===j)&&f.push({command:"z",points:[],start:void 0,pathLength:0})}return f},c.Path.calcLength=function(a,b,d,e){var f,g,h,i=c.Path;switch(d){case"L":return i.getLineLength(a,b,e[0],e[1]);case"C":for(f=0,g=i.getPointOnCubicBezier(0,a,b,e[0],e[1],e[2],e[3],e[4],e[5]),t=.01;1>=t;t+=.01)h=i.getPointOnCubicBezier(t,a,b,e[0],e[1],e[2],e[3],e[4],e[5]),f+=i.getLineLength(g.x,g.y,h.x,h.y),g=h;return f;case"Q":for(f=0,g=i.getPointOnQuadraticBezier(0,a,b,e[0],e[1],e[2],e[3]),t=.01;1>=t;t+=.01)h=i.getPointOnQuadraticBezier(t,a,b,e[0],e[1],e[2],e[3]),f+=i.getLineLength(g.x,g.y,h.x,h.y),g=h;return f;case"A":f=0;var j=e[4],k=e[5],l=e[4]+k,m=Math.PI/180;if(Math.abs(j-l)<m&&(m=Math.abs(j-l)),g=i.getPointOnEllipticalArc(e[0],e[1],e[2],e[3],j,0),0>k)for(t=j-m;t>l;t-=m)h=i.getPointOnEllipticalArc(e[0],e[1],e[2],e[3],t,0),f+=i.getLineLength(g.x,g.y,h.x,h.y),g=h;else for(t=j+m;l>t;t+=m)h=i.getPointOnEllipticalArc(e[0],e[1],e[2],e[3],t,0),f+=i.getLineLength(g.x,g.y,h.x,h.y),g=h;return h=i.getPointOnEllipticalArc(e[0],e[1],e[2],e[3],l,0),f+=i.getLineLength(g.x,g.y,h.x,h.y)}return 0},c.Path.convertEndpointToCenterParameterization=function(a,b,c,d,e,f,g,h,i){var j=i*(Math.PI/180),k=Math.cos(j)*(a-c)/2+Math.sin(j)*(b-d)/2,l=-1*Math.sin(j)*(a-c)/2+Math.cos(j)*(b-d)/2,m=k*k/(g*g)+l*l/(h*h);m>1&&(g*=Math.sqrt(m),h*=Math.sqrt(m));var n=Math.sqrt((g*g*h*h-g*g*l*l-h*h*k*k)/(g*g*l*l+h*h*k*k));e==f&&(n*=-1),isNaN(n)&&(n=0);var o=n*g*l/h,p=n*-h*k/g,q=(a+c)/2+Math.cos(j)*o-Math.sin(j)*p,r=(b+d)/2+Math.sin(j)*o+Math.cos(j)*p,s=function(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])},t=function(a,b){return(a[0]*b[0]+a[1]*b[1])/(s(a)*s(b))},u=function(a,b){return(a[0]*b[1]<a[1]*b[0]?-1:1)*Math.acos(t(a,b))
},v=u([1,0],[(k-o)/g,(l-p)/h]),w=[(k-o)/g,(l-p)/h],x=[(-1*k-o)/g,(-1*l-p)/h],y=u(w,x);return t(w,x)<=-1&&(y=Math.PI),t(w,x)>=1&&(y=0),0===f&&y>0&&(y-=2*Math.PI),1==f&&0>y&&(y+=2*Math.PI),[q,r,g,h,v,y,j,f]},c.Factory.addGetterSetter(c.Path,"data")}(),function(){function a(a){a.fillText(this.partialText,0,0)}function b(a){a.strokeText(this.partialText,0,0)}var d="",e="normal";c.TextPath=function(a){this.___init(a)},c.TextPath.prototype={___init:function(d){var e=this;this.dummyCanvas=document.createElement("canvas"),this.dataArray=[],c.Shape.call(this,d),this._fillFunc=a,this._strokeFunc=b,this._fillFuncHit=a,this._strokeFuncHit=b,this.className="TextPath",this.dataArray=c.Path.parsePathData(this.attrs.data),this.on("dataChange.kinetic",function(){e.dataArray=c.Path.parsePathData(this.attrs.data)}),this.on("textChange.kinetic textStroke.kinetic textStrokeWidth.kinetic",e._setTextData),e._setTextData(),this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){a.setAttr("font",this._getContextFont()),a.setAttr("textBaseline","middle"),a.setAttr("textAlign","left"),a.save();for(var b=this.glyphInfo,c=0;c<b.length;c++){a.save();var d=b[c].p0;a.translate(d.x,d.y),a.rotate(b[c].rotation),this.partialText=b[c].text,a.fillStrokeShape(this),a.restore()}a.restore()},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},setText:function(a){c.Text.prototype.setText.call(this,a)},_getTextSize:function(a){var b=this.dummyCanvas,c=b.getContext("2d");c.save(),c.font=this._getContextFont();var d=c.measureText(a);return c.restore(),{width:d.width,height:parseInt(this.attrs.fontSize,10)}},_setTextData:function(){var a=this,b=this._getTextSize(this.attrs.text);this.textWidth=b.width,this.textHeight=b.height,this.glyphInfo=[];for(var d,e,f,g=this.attrs.text.split(""),h=-1,i=0,j=function(){i=0;for(var b=a.dataArray,c=h+1;c<b.length;c++){if(b[c].pathLength>0)return h=c,b[c];"M"==b[c].command&&(d={x:b[c].points[0],y:b[c].points[1]})}return{}},k=function(b){var g=a._getTextSize(b).width,h=0,k=0;for(e=void 0;Math.abs(g-h)/g>.01&&25>k;){k++;for(var l=h;void 0===f;)f=j(),f&&l+f.pathLength<g&&(l+=f.pathLength,f=void 0);if(f==={}||void 0===d)return void 0;var m=!1;switch(f.command){case"L":c.Path.getLineLength(d.x,d.y,f.points[0],f.points[1])>g?e=c.Path.getPointOnLine(g,d.x,d.y,f.points[0],f.points[1],d.x,d.y):f=void 0;break;case"A":var n=f.points[4],o=f.points[5],p=f.points[4]+o;0===i?i=n+1e-8:g>h?i+=Math.PI/180*o/Math.abs(o):i-=Math.PI/360*o/Math.abs(o),(0>o&&p>i||o>=0&&i>p)&&(i=p,m=!0),e=c.Path.getPointOnEllipticalArc(f.points[0],f.points[1],f.points[2],f.points[3],i,f.points[6]);break;case"C":0===i?i=g>f.pathLength?1e-8:g/f.pathLength:g>h?i+=(g-h)/f.pathLength:i-=(h-g)/f.pathLength,i>1&&(i=1,m=!0),e=c.Path.getPointOnCubicBezier(i,f.start.x,f.start.y,f.points[0],f.points[1],f.points[2],f.points[3],f.points[4],f.points[5]);break;case"Q":0===i?i=g/f.pathLength:g>h?i+=(g-h)/f.pathLength:i-=(h-g)/f.pathLength,i>1&&(i=1,m=!0),e=c.Path.getPointOnQuadraticBezier(i,f.start.x,f.start.y,f.points[0],f.points[1],f.points[2],f.points[3])}void 0!==e&&(h=c.Path.getLineLength(d.x,d.y,e.x,e.y)),m&&(m=!1,f=void 0)}},l=0;l<g.length&&(k(g[l]),void 0!==d&&void 0!==e);l++){var m=c.Path.getLineLength(d.x,d.y,e.x,e.y),n=0,o=c.Path.getPointOnLine(n+m/2,d.x,d.y,e.x,e.y),p=Math.atan2(e.y-d.y,e.x-d.x);this.glyphInfo.push({transposeX:o.x,transposeY:o.y,text:g[l],rotation:p,p0:d,p1:e}),d=e}}},c.TextPath.prototype._getContextFont=c.Text.prototype._getContextFont,c.Util.extend(c.TextPath,c.Shape),c.Factory.addGetterSetter(c.TextPath,"fontFamily","Arial"),c.Factory.addGetterSetter(c.TextPath,"fontSize",12),c.Factory.addGetterSetter(c.TextPath,"fontStyle",e),c.Factory.addGetter(c.TextPath,"text",d)}(),function(){c.RegularPolygon=function(a){this.___init(a)},c.RegularPolygon.prototype={___init:function(a){c.Shape.call(this,a),this.className="RegularPolygon",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){var b,c,d,e=this.attrs.sides,f=this.attrs.radius;for(a.beginPath(),a.moveTo(0,0-f),b=1;e>b;b++)c=f*Math.sin(2*b*Math.PI/e),d=-1*f*Math.cos(2*b*Math.PI/e),a.lineTo(c,d);a.closePath(),a.fillStrokeShape(this)}},c.Util.extend(c.RegularPolygon,c.Shape),c.Factory.addGetterSetter(c.RegularPolygon,"radius",0),c.Factory.addGetterSetter(c.RegularPolygon,"sides",0)}(),function(){c.Star=function(a){this.___init(a)},c.Star.prototype={___init:function(a){c.Shape.call(this,a),this.className="Star",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){var b=this.innerRadius(),c=this.outerRadius(),d=this.numPoints();a.beginPath(),a.moveTo(0,0-c);for(var e=1;2*d>e;e++){var f=0===e%2?c:b,g=f*Math.sin(e*Math.PI/d),h=-1*f*Math.cos(e*Math.PI/d);a.lineTo(g,h)}a.closePath(),a.fillStrokeShape(this)}},c.Util.extend(c.Star,c.Shape),c.Factory.addGetterSetter(c.Star,"numPoints",5),c.Factory.addGetterSetter(c.Star,"innerRadius",0),c.Factory.addGetterSetter(c.Star,"outerRadius",0)}(),function(){var a=["fontFamily","fontSize","fontStyle","padding","lineHeight","text"],b="Change.kinetic",d="none",e="up",f="right",g="down",h="left",i="Label",j=a.length;c.Label=function(a){this.____init(a)},c.Label.prototype={____init:function(a){var b=this;this.className=i,c.Group.call(this,a),this.on("add.kinetic",function(a){b._addListeners(a.child),b._sync()})},getText:function(){return this.find("Text")[0]},getTag:function(){return this.find("Tag")[0]},_addListeners:function(c){var d,e=this,f=function(){e._sync()};for(d=0;j>d;d++)c.on(a[d]+b,f)},getWidth:function(){return this.getText().getWidth()},getHeight:function(){return this.getText().getHeight()},_sync:function(){var a,b,c,d,i,j,k=this.getText(),l=this.getTag();if(k&&l){switch(a=k.getWidth(),b=k.getHeight(),c=l.getPointerDirection(),d=l.getPointerWidth(),pointerHeight=l.getPointerHeight(),i=0,j=0,c){case e:i=a/2,j=-1*pointerHeight;break;case f:i=a+d,j=b/2;break;case g:i=a/2,j=b+pointerHeight;break;case h:i=-1*d,j=b/2}l.setAttrs({x:-1*i,y:-1*j,width:a,height:b}),k.setAttrs({x:-1*i,y:-1*j})}}},c.Util.extend(c.Label,c.Group),c.Tag=function(a){this.___init(a)},c.Tag.prototype={___init:function(a){c.Shape.call(this,a),this.className="Tag",this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){var b=this.getWidth(),c=this.getHeight(),d=this.getPointerDirection(),i=this.getPointerWidth(),j=this.getPointerHeight();this.getCornerRadius(),a.beginPath(),a.moveTo(0,0),d===e&&(a.lineTo((b-i)/2,0),a.lineTo(b/2,-1*j),a.lineTo((b+i)/2,0)),a.lineTo(b,0),d===f&&(a.lineTo(b,(c-j)/2),a.lineTo(b+i,c/2),a.lineTo(b,(c+j)/2)),a.lineTo(b,c),d===g&&(a.lineTo((b+i)/2,c),a.lineTo(b/2,c+j),a.lineTo((b-i)/2,c)),a.lineTo(0,c),d===h&&(a.lineTo(0,(c+j)/2),a.lineTo(-1*i,c/2),a.lineTo(0,(c-j)/2)),a.closePath(),a.fillStrokeShape(this)}},c.Util.extend(c.Tag,c.Shape),c.Factory.addGetterSetter(c.Tag,"pointerDirection",d),c.Factory.addGetterSetter(c.Tag,"pointerWidth",0),c.Factory.addGetterSetter(c.Tag,"pointerHeight",0),c.Factory.addGetterSetter(c.Tag,"cornerRadius",0)}();var d=(function(){try{var b=document.createElement("canvas");return!!a.WebGLRenderingContext&&(b.getContext("webgl")||b.getContext("experimental-webgl"))}catch(c){return!1}}(),function(a,b,c,d){var e=c-a,f=d-b;return Math.sqrt(e*e+f*f)}),e={on:function(a,b,c){this.events||(this.events={});for(var d=a.split(" "),e=0,f=d.length;f>e;e++)a=d[e],this.events[a]||(this.events[a]=[]),this.events[a].push({fn:b,context:c||this});return this},off:function(a,b){for(var c,d,e=a?a.split(" "):_.keys(this.events),f=this.events,g=0,h=e.length;h>g;g++)if(d=e[g],b){if(c=f[d])for(var i=0,h=c.length;h>i;i++)b&&c[i].fn===b&&c.splice(i,1)}else delete f[d]},trigger:function(a){var b,c,d=this.events;if(d&&(b=d[a]))for(var e=0,f=b.length;f>e;e++)c=b[e],c.fn.apply(c.context||this,[].slice.call(arguments,1))}},f=function(){var a=this;this.x=0,this.y=0,this.startX=0,this.startY=0,this.currentX=0,this.currentY=0,this.speed=1,this.distance=0;var b=function(b){a.currentX=b.clientX,a.currentY=b.clientY;var c=a.currentX-a.startX,e=a.currentY-a.startY;a.directionX=0>c?"left":"right",a.directionY=0>e?"top":"bottom",a.direction=Math.abs(c)>Math.abs(e)?a.directionX:a.directionY,a.distance=d(a.startX,a.startY,a.currentX,a.currentY)};this.register=function(){$(document).on("mousemove",b).on("mousemove",this.onMouseMove).on("mouseup",this.onMouseUp).on("mouseup",this.deregister)},this.deregister=function(){$(document).off("mousemove",b).off("mousemove",this.onMouseMove).off("mouseup",this.onMouseUp).off("mouseup",this.deregister)}};jQuery.extend(f.prototype,e,{setSpeed:function(a){this.speed=a},start:function(a){this.startX=a.clientX?a.clientX:a.x,this.startY=a.clientY?a.clientY:a.y,this.register()}});var g=function(a){var b=new Image,c=!1,d=jQuery.Deferred();return b.onload=function(){c=!0,d.resolve(b)},b.src=a,b.complete&&!c&&d.resolve(b),d.promise()},h=function(a,c){var d=[],e=jQuery.Deferred(),f=a;return c||(c=function(a){return a}),b(f,function(a,b,e){var f=new g(a);f.done(function(a){e[b]=c(a)}),d.push(f)}),jQuery.when.apply(null,d).done(function(){e.resolve(f)}),e.promise()},i={},j=1,k=2,l=3,m=function(){return a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(b){a.setTimeout(b,1e3/60)}}();i.Animation=function(a){var b=this;this.anim=function(){b.enabled&&(a(),m(b.anim))}},i.Animation.prototype={start:function(){this.enabled=!0,this.anim()},stop:function(){this.enabled=!1}},i.Tween=function(a){var b=this,c=a.duration||1,d=a.easing||i.easings.Linear,e=!!a.yoyo;this.setAttrs(a.attrs),this.onFrame=a.onFrame,this.anim=new i.Animation(function(){b.tween.onEnterFrame()}),this.tween=new n(function(a){b.tweenFunc(a)},d,1e3*c,e),this.addListeners(),this.tween.onFinish=a.onFinish,this.onFinish=a.onFinish,this.onReset=a.onReset},i.Tween.prototype={setAttrs:function(a){this.attrs=a;for(var b in this.attrs)this.attrs[b].diff=this.attrs[b].end-this.attrs[b].start},tweenFunc:function(a){var b,c,d={};for(b in this.attrs)c=this.attrs[b],d[b]=c.start+c.diff*a;this.onFrame(d)},addListeners:function(){var a=this;this.tween.onPlay=function(){a.anim.start()},this.tween.onReverse=function(){a.anim.start()},this.tween.onPause=function(){a.anim.stop()}},play:function(){return this.tween.play(),this},reverse:function(){return this.tween.reverse(),this},reset:function(){this.node;return this.tween.reset(),this},seek:function(a){this.node;return this.tween.seek(1e3*a),this},pause:function(){return this.tween.pause(),this},finish:function(){this.node;return this.tween.finish(),this}};var n=function(a,b,c,d){var e=0,f=1;this.propFunc=a,this.begin=e,this._pos=e,this.duration=c,this._change=0,this.prevPos=0,this.yoyo=d,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=b,this._change=f-this.begin,this.pause()};n.prototype={fire:function(a){var b=this[a];b&&b()},setTime:function(a){a>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():0>a?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=a,this.update())},getTime:function(){return this._time},setPosition:function(a){this.prevPos=this._pos,this.propFunc(a),this._pos=a},getPosition:function(a){return void 0===a&&(a=this._time),this.func(a,this.begin,this._change,this.duration)},play:function(){this.fire("onPlay"),this.state=k,this._startTime=this.getTimer()-this._time,this.onEnterFrame()},reverse:function(){this.fire("onReverse"),this.state=l,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame()},seek:function(a){this.pause(),this._time=a,this.update()},reset:function(){this.pause(),this._time=0,this.update()},finish:function(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")},update:function(){this.setPosition(this.getPosition(this._time))},onEnterFrame:function(){var a=this.getTimer()-this._startTime;this.state===k?this.setTime(a):this.state===l&&this.setTime(this.duration-a)},pause:function(){this.fire("onPause"),this.state=j},getTimer:function(){return(new Date).getTime()}},i.easings={BackEaseIn:function(a,b,c,d){var e=1.70158;return c*(a/=d)*a*((e+1)*a-e)+b},BackEaseOut:function(a,b,c,d){var e=1.70158;return c*((a=a/d-1)*a*((e+1)*a+e)+1)+b},BackEaseInOut:function(a,b,c,d){var e=1.70158;return(a/=d/2)<1?c/2*a*a*(((e*=1.525)+1)*a-e)+b:c/2*((a-=2)*a*(((e*=1.525)+1)*a+e)+2)+b},ElasticEaseIn:function(a,b,c,d,e,f){var g=0;return 0===a?b:1==(a/=d)?b+c:(f||(f=.3*d),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),-(e*Math.pow(2,10*(a-=1))*Math.sin(2*(a*d-g)*Math.PI/f))+b)},ElasticEaseOut:function(a,b,c,d,e,f){var g=0;return 0===a?b:1==(a/=d)?b+c:(f||(f=.3*d),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),e*Math.pow(2,-10*a)*Math.sin(2*(a*d-g)*Math.PI/f)+c+b)},ElasticEaseInOut:function(a,b,c,d,e,f){var g=0;return 0===a?b:2==(a/=d/2)?b+c:(f||(f=.3*d*1.5),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),1>a?-.5*e*Math.pow(2,10*(a-=1))*Math.sin(2*(a*d-g)*Math.PI/f)+b:e*Math.pow(2,-10*(a-=1))*Math.sin(2*(a*d-g)*Math.PI/f)*.5+c+b)},BounceEaseOut:function(a,b,c,d){return(a/=d)<1/2.75?7.5625*c*a*a+b:2/2.75>a?c*(7.5625*(a-=1.5/2.75)*a+.75)+b:2.5/2.75>a?c*(7.5625*(a-=2.25/2.75)*a+.9375)+b:c*(7.5625*(a-=2.625/2.75)*a+.984375)+b},BounceEaseIn:function(a,b,d,e){return d-c.Easings.BounceEaseOut(e-a,0,d,e)+b},BounceEaseInOut:function(a,b,d,e){return e/2>a?.5*c.Easings.BounceEaseIn(2*a,0,d,e)+b:.5*c.Easings.BounceEaseOut(2*a-e,0,d,e)+.5*d+b},EaseIn:function(a,b,c,d){return c*(a/=d)*a+b},EaseOut:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},EaseInOut:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b},StrongEaseIn:function(a,b,c,d){return c*(a/=d)*a*a*a*a+b},StrongEaseOut:function(a,b,c,d){return c*((a=a/d-1)*a*a*a*a+1)+b},StrongEaseInOut:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a*a*a*a+b:c/2*((a-=2)*a*a*a*a+2)+b},Linear:function(a,b,c,d){return c*a/d+b}};var o=function(a){var b=this;$.extend(this,a),this.length=100,this.shape=new c.Shape({sceneFunc:function(a){a.save(),a.scale(this.iconScale,this.iconScale),a.drawImage(b.image,-50,0),a.restore()},hitFunc:function(a){a.save(),a.scale(this.iconScale,this.iconScale),a.beginPath(),a.rect(-50,0,100,100),a.closePath(),a.restore(),a.fillStrokeShape(this)}}),this.shape.iconScale=1,this.shape.on("click",function(a){b.menu.trigger("itemClicked",a,b)}),this.shape.on("mousedown",function(a){b.menu.trigger("itemMousedown",a)}),this.shape.on("mouseenter",function(){document.body.style.cursor="pointer"}),this.shape.on("mouseleave",function(){document.body.style.cursor="default"})};jQuery.extend(o.prototype,e,{initialize:function(){},draw:function(a){var b=a-this.menu.startPoint,c=b/this.length,d=Math.abs(c),e=c/(d||1),f=e*Math.min(90*d,90);this.shape.setX(320+f+75*c),this.shape.setY(90+466*Math.cos(.1*d-Math.PI/2)),this.shape.iconScale=Math.max(1/(1+d),.5)}});var p=function(a){var b=this;$.extend(this,a),this.items=[],this.width=0,this.position=0,this.startPoint=320,this.inertia=new i.Tween({duration:.6,easing:i.easings.EaseOut,onFrame:function(a){b.setPosition(a.position),b.render()},onFinish:function(){b.trigger("stop",b.items[b.activeIndex-1])}})};jQuery.extend(p.prototype,e,{add:function(a){this.layer.add(a.shape),a.initialize(this.layer),a.menu=this,this.items.push(a),this.width+=a.length},getPosition:function(){return this.position},setPosition:function(a){this.position=this.getAllowedPosition(a)},getAllowedPosition:function(a){return a=Math.max(a,-this.width+this.startPoint),a=Math.min(a,this.startPoint-100)},render:function(){for(var a,b=this.position,c=0;c<this.items.length;c++)a=this.items[c],b+=a.length,a.draw(b);this.layer.draw()},start:function(){this.inertia.pause(),this.startTime=(new Date).getTime(),this.startPosition=this.position,this.trigger("start")},getInertiaPosition:function(){var a,b=this.startPosition-this.position,c=(new Date).getTime()-this.startTime,d=b/c,e=Math.round(100*d);return a=this.position-e,this.getAllowedPosition(a)},getNearestItemPosition:function(a){return this.activeIndex=Math.round(Math.abs((320-a)/100)),this.activeItem=this.items[this.activeIndex-1],320-100*this.activeIndex},stop:function(){var a=this.getInertiaPosition();a=this.getNearestItemPosition(a),this.endPosition=a,this.inertia.setAttrs({position:{start:this.position,end:a}}),this.inertia.reset(),this.inertia.play()},goTo:function(a){this.createTween(this.getNearestItemPosition(a))},next:function(){var a=this.endPosition||this.position,b=this.getNearestItemPosition(this.getAllowedPosition(a-100));this.createTween(b)},prev:function(){var a=this.endPosition||this.position,b=this.getNearestItemPosition(this.getAllowedPosition(a+100));this.createTween(b)},createTween:function(a){this.inertia.pause(),this.endPosition=a,this.inertia.setAttrs({position:{start:this.position,end:a}}),this.inertia.reset(),this.inertia.play()}}),function(b){b.fn.curveui=function(d){function e(a){a.on("mouseenter",function(){document.body.style.cursor="pointer"}),a.on("mouseleave",function(){document.body.style.cursor="default"})}return this.each(function(){var g,i=new c.Layer,j=b(this),k=[];g=new c.Stage({container:"slider",width:640,height:366}),g.add(i),b.each(d.items,function(a,b){k.push(b.image)}),b.when(h(d.images),h(k)).done(function(g,h){function k(){r&&m(k),y.setPosition(v),y.render()}var l,n,q,r,s,t,u=2,v=0,w=new f,x=new f,y=new p({layer:i});q=new c.Text({x:170,y:285,text:"",fontSize:35,fontFamily:"Trebuchet MS",fill:"#fff",align:"center",width:300}),l=new c.Image({image:g.leftArrow,x:110,y:285}),n=new c.Image({image:g.rightArrow,x:490,y:285}),i.add(new c.Image({image:g.background})),b.each(d.items,function(a,b){y.add(new o({text:b.text,url:b.url,image:h[a],margin:50,index:a}))}),y.on("itemClicked",function(b,c){c===y.activeItem&&a.open(c.url,"_blank")}),q.on("click",function(){a.open(q.item.url,"_blank")}),y.on("stop",function(a){q.item=a,q.text(a.text),i.draw()}),y.setPosition(y.getNearestItemPosition(y.width)),y.render(),q.item=y.activeItem,q.text(y.activeItem.text),x.onMouseMove=function(a){v=t+(a.clientX-s)*u},x.onMouseUp=function(){r=!1,y.stop()},w.onMouseMove=function(a){w.distance>5&&(x.start({x:w.startX,y:w.startY}),y.start(),r=!0,s=a.clientX,t=y.getPosition(),v=t,k(),w.deregister())},w.onMouseUp=function(){},j.on("mousedown",function(a){w.start(a)}),i.add(q),i.add(l),i.add(n),l.cache(),l.drawHitFromCache(),n.cache(),n.drawHitFromCache(),e(q),e(l),e(n),l.on("click",function(){w.deregister(),y.prev()}),n.on("click",function(){w.deregister(),y.next()}),i.draw()})})}}(jQuery)}(window);